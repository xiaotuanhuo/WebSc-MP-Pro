<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sc.mp.mapper.DocMapper">

    <resultMap id="BaseResultMap" type="com.sc.mp.model.WebScDoc">
    	<id column="document_id" jdbcType="VARCHAR" property="documentId"/>
    	<result column="operative_id" jdbcType="VARCHAR" property="operativeId"/>
    	<result column="operative_name" jdbcType="VARCHAR" property="operativeName"/>
    	<result column="anesthetic_id" jdbcType="VARCHAR" property="anestheticId"/>
    	<result column="anesthetic_name" jdbcType="VARCHAR" property="anestheticName"/>
    	<result column="patient_name" jdbcType="VARCHAR" property="patientName"/>
    	<result column="patient_age" jdbcType="INTEGER" property="patientAge"/>
    	<result column="patient_sex" jdbcType="VARCHAR" property="patientSex"/>
    	<result column="patient_num" jdbcType="VARCHAR" property="patientNum"/>
    	<result column="patient_bednum" jdbcType="VARCHAR" property="patientBednum"/>
    	<result column="patienttype_id" jdbcType="VARCHAR" property="patienttypeId"/>
    	<result column="operationtype_id" jdbcType="VARCHAR" property="operationtypeId"/>
    	<result column="document_title" jdbcType="VARCHAR" property="documentTitle"/>
    	<result column="document_type" jdbcType="VARCHAR" property="documentType"/>
    	<result column="operate_user" jdbcType="VARCHAR" property="operateUser"/>
    	<result column="operate_aide" jdbcType="VARCHAR" property="operateQide"/>
    	<result column="apply_user_id" jdbcType="VARCHAR" property="applyUserId"/>
    	<result column="apply_user_name" jdbcType="VARCHAR" property="applyUserName"/>
    	<result column="admin_user_id" jdbcType="VARCHAR" property="adminUserId"/>
    	<result column="admin_user_name" jdbcType="VARCHAR" property="adminUserName"/>
    	<result column="qa_user_id" jdbcType="VARCHAR" property="qaUserId"/>
    	<result column="qa_user_name" jdbcType="VARCHAR" property="qaUserName"/>
    	<result column="qa_team_id" jdbcType="VARCHAR" property="qaTeamId"/>
    	<result column="hospital_memo" jdbcType="VARCHAR" property="hospitalMemo"/>
    	<result column="qa_memo" jdbcType="VARCHAR" property="qaMemo"/>
    	<result column="admin_memo" jdbcType="VARCHAR" property="adminMemo"/>
    	<result column="memo" jdbcType="VARCHAR" property="memo"/>
    	<result column="document_state" jdbcType="VARCHAR" property="documentState"/>
    	<result column="operate_start_time" jdbcType="VARCHAR" property="operateStartTime"/>
    	<result column="operate_end_time" jdbcType="VARCHAR" property="operateEndTime"/>
    	<result column="create_date" jdbcType="VARCHAR" property="createDate"/>
    	<result column="hospital_evaluate" jdbcType="FLOAT" property="hospitalEvaluate"/>
    	<result column="hospital_evaluate_memo" jdbcType="VARCHAR" property="hospitalEvaluateMemo"/>
    	<result column="doctor_evaluate" jdbcType="FLOAT" property="doctorEvaluate"/>
    	<result column="doctor_evaluate_memo" jdbcType="VARCHAR" property="doctorEvaluateMemo"/>
    	<result column="old_document_state" jdbcType="VARCHAR" property="oldDocumentState"/>
    	<result column="delete_reason" jdbcType="VARCHAR" property="deleteReason"/>
    	<result column="transfer_user_id" jdbcType="VARCHAR" property="transferUserId"/>
    	
    	
    	<result column="org_id" jdbcType="VARCHAR" property="orgId"/>
    	<result column="org_name" jdbcType="VARCHAR" property="orgName"/>
    	<result column="org_address" jdbcType="VARCHAR" property="orgAddress"/>
    	<result column="org_tel" jdbcType="VARCHAR" property="orgTel"/>
    	<result column="leader_name" jdbcType="VARCHAR" property="leaderName"/>
    	<result column="leader_tel" jdbcType="VARCHAR" property="leaderTel"/>
    	<result column="org_province" jdbcType="VARCHAR" property="orgProvince"/>
    	<result column="org_city" jdbcType="VARCHAR" property="orgCity"/>
    	<result column="org_area" jdbcType="VARCHAR" property="orgArea"/>
    	
    	<result column="tmp_operative_id" jdbcType="VARCHAR" property="tmpOperativeId"/>
    	<result column="tmp_operative_name" jdbcType="VARCHAR" property="tmpOperativeName"/>
    	<result column="tmp_anesthetic_id" jdbcType="VARCHAR" property="tmpAnestheticId"/>
    	<result column="tmp_anesthetic_name" jdbcType="VARCHAR" property="tmpAnestheticName"/>
    	<result column="tmp_patient_name" jdbcType="VARCHAR" property="tmpPatientName"/>
    	<result column="tmp_patient_age" jdbcType="NUMERIC" property="tmpPatientAge"/>
    	<result column="tmp_patient_sex" jdbcType="VARCHAR" property="tmpPatientSex"/>
    	
    	<result column="height" jdbcType="NUMERIC" property="height"/>
    	<result column="weight" jdbcType="NUMERIC" property="weight"/>
    	<result column="asa" jdbcType="VARCHAR" property="asa"/>
    	<result column="xtbs" jdbcType="VARCHAR" property="xtbs"/>
    	<result column="shs" jdbcType="VARCHAR" property="shs"/>
    	<result column="shcs" jdbcType="NUMERIC" property="shcs"/>
    	<result column="sskssj" jdbcType="VARCHAR" property="sskssj"/>
    	<result column="ssjssj" jdbcType="VARCHAR" property="ssjssj"/>
    	<result column="sssc" jdbcType="NUMERIC" property="sssc"/>
    	<result column="jmjs" jdbcType="VARCHAR" property="jmjs"/>
    	<result column="ywsj_hxxt" jdbcType="VARCHAR" property="ywsjHxxt"/>
    	<result column="ywsj_hxxt_qt" jdbcType="VARCHAR" property="ywsjHxxtQt"/>
    	<result column="ywsj_xhxt" jdbcType="VARCHAR" property="ywsjXhxt"/>
    	<result column="ywsj_xhxt_qt" jdbcType="VARCHAR" property="ywsjXhxtQt"/>
    	<result column="ywsj_gm" jdbcType="VARCHAR" property="ywsjGm"/>
    	<result column="ywsj_gm_socre" jdbcType="VARCHAR" property="ywsjGmAocre"/>
    	<result column="ywsj_qt" jdbcType="VARCHAR" property="ywsjQt"/>
    	<result column="shbl_zw" jdbcType="VARCHAR" property="shblZw"/>
    	<result column="shbl_hbtt" jdbcType="VARCHAR" property="shblHbtt"/>
    	<result column="shbl_ex" jdbcType="VARCHAR" property="shblEx"/>
    	<result column="shbl_xy" jdbcType="VARCHAR" property="shblXy"/>
    	<result column="shbl_ot" jdbcType="VARCHAR" property="shblOt"/>
    	<result column="shbl_ot_score" jdbcType="NUMERIC" property="shblOtScore"/>
    	<result column="shttzl" jdbcType="VARCHAR" property="shttzl"/>
    	<result column="photo_1" jdbcType="VARCHAR" property="photo_1"/>
    	<result column="photo_2" jdbcType="VARCHAR" property="photo_2"/>
    	<result column="photo_3" jdbcType="VARCHAR" property="photo_3"/>
    	<result column="photo_4" jdbcType="VARCHAR" property="photo_4"/>
    	<result column="photo_5" jdbcType="VARCHAR" property="photo_5"/>
    	<result column="status" jdbcType="VARCHAR" property="status"/>
    	
    	<result column="qxRadio" jdbcType="VARCHAR" property="qxRadio"/>
    </resultMap>
    
    <resultMap id="BaseResultMap_Fp" type="com.sc.mp.model.WebScUser_Distribution">
    	<result column="user_id" jdbcType="VARCHAR" property="userId"/>
    	<result column="user_name" jdbcType="VARCHAR" property="userName"/>
    	<result column="isrecord" jdbcType="VARCHAR" property="isrecord"/>
    	<result column="iscalendar" jdbcType="VARCHAR" property="iscalendar"/>
    	<result column="province" jdbcType="VARCHAR" property="province"/>
    	<result column="city" jdbcType="VARCHAR" property="city"/>
    	<result column="area" jdbcType="VARCHAR" property="area"/>
    	<result column="patient_type" jdbcType="VARCHAR" property="patient_type"/>
    	<result column="operation_type" jdbcType="VARCHAR" property="operation_type"/>
    </resultMap>
    
    <resultMap id="BaseResultMap_Org" type="com.sc.mp.model.WebScOrganization">
    	<result column="org_id" jdbcType="VARCHAR" property="orgId"/>
    	<result column="org_pid" jdbcType="VARCHAR" property="orgPid"/>
    	<result column="org_name" jdbcType="VARCHAR" property="orgName"/>
    	<result column="org_address" jdbcType="VARCHAR" property="orgAddress"/>
    	<result column="org_tel" jdbcType="VARCHAR" property="orgTel"/>
    	<result column="leader_name" jdbcType="VARCHAR" property="leaderName"/>
    	<result column="leader_tel" jdbcType="VARCHAR" property="leaderTel"/>
    	<result column="province" jdbcType="VARCHAR" property="province"/>
    	<result column="city" jdbcType="VARCHAR" property="city"/>
    	<result column="area" jdbcType="VARCHAR" property="area"/>
    </resultMap>
    
    <resultMap id="BaseResultMap_TransferUser" type="com.sc.mp.model.WebScUser">
    	<result column="user_id" jdbcType="NUMERIC" property="userId"/>
    	<result column="user_name" jdbcType="VARCHAR" property="userName"/>
    	<result column="sex" jdbcType="VARCHAR" property="sex"/>
    	<result column="age" jdbcType="NUMERIC" property="age"/>
    </resultMap>
    
    <sql id="Base_Column_List">
        document_id,
		operative_id,
		anesthetic_id,
		patient_name,
		patient_age,
		patient_sex,
		patient_num,
		patient_bednum,
		patienttype_id,
		operationtype_id,
		document_title,
		document_type,
		operate_user,
		operate_aide,
		apply_user_id,
		admin_user_id,
		qa_user_id,
		qa_team_id,
		org_id,
		hospital_memo,
		qa_memo,
		admin_memo,
		memo,
		document_state,
		operate_start_time,
		operate_end_time,
		DATE_FORMAT(create_date, '%Y-%m-%d %H:%k:%s') as create_date,
		hospital_evaluate,
		hospital_evaluate_memo,
		doctor_evaluate,
		doctor_evaluate_memo
    </sql>
    
    <sql id="Tmp_Base_Column_List">
    	document_id, patient_name as tmp_patient_name, patient_age as tmp_patient_age, 
    	patient_sex as tmp_patient_sex, operative_id as tmp_operative_id, 
    	anesthetic_id as tmp_anesthetic_id, 
    	height, weight, asa, xtbs, shs, shcs, sskssj, ssjssj, sssc, jmjs, ywsj_hxxt, ywsj_hxxt_qt, 
    	ywsj_xhxt, ywsj_xhxt_qt, ywsj_gm, ywsj_gm_socre, ywsj_qt, shbl_zw, shbl_hbtt, shbl_ex, 
    	shbl_xy, shbl_ot, shbl_ot_score, shttzl, photo_1, photo_2, photo_3, photo_4, photo_5, 
    	status
    </sql>
    
    <select id="selectWebScDocTmps" resultMap="BaseResultMap" parameterType="hashmap">
    	SELECT
			<include refid="Tmp_Base_Column_List" />
		FROM
			WSC_DOCUMENT_TMP tmp
		WHERE
			tmp.document_id IN (
				SELECT
					document_id
				FROM
					WSC_DOCUMENT doc
				WHERE
					doc.org_id = #{orgId,jdbcType=VARCHAR}
				AND doc.document_state = #{state,jdbcType=VARCHAR}
			)
			AND
			tmp.status = '1' 
		ORDER BY
			tmp.sskssj DESC
		LIMIT ${limit};
    </select>
    
    <select id="selectXcxDocsByConditions" resultMap="BaseResultMap" parameterType="hashmap">
	  	select 
	    <include refid="Base_Column_List" />
	    from 
	    WSC_DOCUMENT doc 
	    where 
	    1=1 
	    <if test="orgId != null and orgId != ''" >
	    	and org_id = #{orgId,jdbcType=VARCHAR}
	    </if>
	    <if test="patientName != null and patientName != ''" >
	    	and patient_name = #{patientName,jdbcType=VARCHAR}
	    </if>
	    <if test="operateUser != null and operateUser != ''" >
	    	and operate_user = #{operateUser,jdbcType=VARCHAR}
	    </if>
	    <if test="qaUserId != null and qaUserId != ''" >
	    	and qa_user_id = #{qaUserId,jdbcType=VARCHAR}
	    </if>
	    <if test="startDate != null and startDate != ''" >
	    	<![CDATA[
	    		and operate_start_time >= #{startDate,jdbcType=VARCHAR}
	    	]]>
	    </if>
	    <if test="endDate != null and endDate != ''" >
	    	<![CDATA[
	    		and operate_start_time <= #{endDate,jdbcType=VARCHAR}
	    	]]>
	    </if>
	    <if test="flag == 'evaluateOrder'" >
	    	and document_state = '5'
	    	and hospital_evaluate = '-1'
	    </if>
	    order by operate_start_time desc
	</select>
    
    <select id="selectImportDocsByConditions" resultMap="BaseResultMap" parameterType="hashmap">
	  	select 
	    <include refid="Base_Column_List" />
	    from 
	    WSC_DOCUMENT doc 
	    where 
	    apply_user_id = #{userId,jdbcType=VARCHAR}
	    <if test="doctorName != null and doctorName != ''" >
	    	and operate_user = #{doctorName,jdbcType=VARCHAR}
	    </if>
	    <if test="orgId != null and orgId != ''" >
	    	and org_id = #{orgId,jdbcType=VARCHAR}
	    </if>
	    <if test="startDate != null and startDate != ''" >
	    	<![CDATA[
	    		and operate_start_time >= #{startDate,jdbcType=VARCHAR}
	    	]]>
	    </if>
	    <if test="endDate != null and endDate != ''" >
	    	<![CDATA[
	    		and operate_start_time <= #{endDate,jdbcType=VARCHAR}
	    	]]>
	    </if>
	</select>
    
    <insert id="insert" parameterType="com.sc.mp.model.WebScDoc">
    	insert into WSC_DOCUMENT(document_id,
								operative_id,
								anesthetic_id,
								patient_name,
								patient_age,
								patient_sex,
								patient_num,
								patient_bednum,
								patienttype_id,
								operationtype_id,
								document_title,
								document_type,
								operate_user,
								operate_aide,
								apply_user_id,
								memo,
								document_state,
								operate_start_time,
								org_id)
					values(#{documentId,jdbcType=VARCHAR},
							#{operativeId,jdbcType=VARCHAR},
							#{anestheticId,jdbcType=VARCHAR},
							#{patientName,jdbcType=VARCHAR},
							#{patientAge,jdbcType=INTEGER},
							#{patientSex,jdbcType=VARCHAR},
							#{patientNum,jdbcType=VARCHAR},
							#{patientBednum,jdbcType=VARCHAR},
							#{patienttypeId,jdbcType=VARCHAR},
							#{operationtypeId,jdbcType=VARCHAR},
							#{documentTitle,jdbcType=VARCHAR},
							#{documentType,jdbcType=VARCHAR},
							#{operateUser,jdbcType=VARCHAR},
							#{operateQide,jdbcType=VARCHAR},
							#{applyUserId,jdbcType=VARCHAR},
							#{memo,jdbcType=VARCHAR},
							#{documentState,jdbcType=VARCHAR},
							#{operateStartTime,jdbcType=VARCHAR},
							#{orgId,jdbcType=VARCHAR})
    </insert>
    
    <update id="updateByPrimaryKey" parameterType="com.sc.mp.model.WebScDoc">
    	update WSC_DOCUMENT 
    	<set>
            <if test="operativeId != null">
                operative_id = #{operativeId,jdbcType=VARCHAR},
            </if>
            <if test="anestheticId != null">
                anesthetic_id = #{anestheticId,jdbcType=VARCHAR},
            </if>
            <if test="patientName != null">
                patient_name = #{patientName,jdbcType=VARCHAR},
            </if>
            <if test="patientAge != null">
                patient_age = #{patientAge,jdbcType=INTEGER},
            </if>
            <if test="patientSex != null">
                patient_sex = #{patientSex,jdbcType=VARCHAR},
            </if>
            <if test="patientNum != null">
                patient_num = #{patientNum,jdbcType=VARCHAR},
            </if>
            <if test="patientBednum != null">
                patient_bednum = #{patientBednum,jdbcType=VARCHAR},
            </if>
            <if test="patienttypeId != null">
                patienttype_id = #{patienttypeId,jdbcType=VARCHAR},
            </if>
            <if test="operationtypeId != null">
                operationtype_id = #{operationtypeId,jdbcType=VARCHAR},
            </if>
            <if test="documentTitle != null">
                document_title = #{documentTitle,jdbcType=VARCHAR},
            </if>
            <if test="documentType != null">
                document_type = #{documentType,jdbcType=VARCHAR},
            </if>
            <if test="operateUser != null">
                operate_user = #{operateUser,jdbcType=VARCHAR},
            </if>
            <if test="operateQide != null">
                operate_aide = #{operateQide,jdbcType=VARCHAR},
            </if>
            <if test="applyUserId != null">
                apply_user_id = #{applyUserId,jdbcType=VARCHAR},
            </if>
            <if test="adminUserId != null">
                admin_user_id = #{adminUserId,jdbcType=VARCHAR},
            </if>
            <if test="qaUserId != null">
                qa_user_id = #{qaUserId,jdbcType=VARCHAR},
            </if>
            <if test="qaTeamId != null">
                qa_team_id = #{qaTeamId,jdbcType=VARCHAR},
            </if>
            <if test="hospitalMemo != null">
                hospital_memo = #{hospitalMemo,jdbcType=VARCHAR},
            </if>
            <if test="qaMemo != null">
                qa_memo = #{qaMemo,jdbcType=VARCHAR},
            </if>
            <if test="adminMemo != null">
                admin_memo = #{adminMemo,jdbcType=VARCHAR},
            </if>
            <if test="memo != null">
                memo = #{memo,jdbcType=VARCHAR},
            </if>
            <if test="documentState != null">
                document_state = #{documentState,jdbcType=VARCHAR},
            </if>
            <if test="operateStartTime != null">
                operate_start_time = #{operateStartTime,jdbcType=VARCHAR},
            </if>
            <if test="operateEndTime != null">
                operate_end_time = #{operateEndTime,jdbcType=VARCHAR},
            </if>
            <if test="hospitalEvaluate != null">
                hospital_evaluate = #{hospitalEvaluate,jdbcType=FLOAT},
            </if>
            <if test="hospitalEvaluateMemo != null">
                hospital_evaluate_memo = #{hospitalEvaluateMemo,jdbcType=VARCHAR},
            </if>
            <if test="doctorEvaluate != null">
                doctor_evaluate = #{doctorEvaluate,jdbcType=FLOAT},
            </if>
            <if test="doctorEvaluateMemo != null">
                doctor_evaluate_memo = #{doctorEvaluateMemo,jdbcType=VARCHAR},
            </if>
            <if test="transferUserId != null">
                transfer_user_id = #{transferUserId,jdbcType=VARCHAR},
            </if>
            <if test="oldDocumentState != null">
                old_document_state = #{oldDocumentState,jdbcType=VARCHAR},
            </if>
            <if test="deleteReason != null">
                delete_reason = #{deleteReason,jdbcType=VARCHAR},
            </if>
            <if test="qxRadio != null">
                qx_radio = #{qxRadio,jdbcType=VARCHAR},
            </if>
		</set>
        where document_id = #{documentId,jdbcType=VARCHAR}
    </update>
    
    <update id="updateDocInfoByMap" parameterType="java.util.Map">
    	update WSC_DOCUMENT 
    	<set>
            <if test="operativeId != null">
                operative_id = #{operativeId,jdbcType=VARCHAR},
            </if>
            <if test="anestheticId != null">
                anesthetic_id = #{anestheticId,jdbcType=VARCHAR},
            </if>
            <if test="patientName != null">
                patient_name = #{patientName,jdbcType=VARCHAR},
            </if>
            <if test="patientAge != null">
                patient_age = #{patientAge,jdbcType=INTEGER},
            </if>
            <if test="patientSex != null">
                patient_sex = #{patientSex,jdbcType=VARCHAR},
            </if>
            <if test="patientNum != null">
                patient_num = #{patientNum,jdbcType=VARCHAR},
            </if>
            <if test="patientBednum != null">
                patient_bednum = #{patientBednum,jdbcType=VARCHAR},
            </if>
            <if test="patienttypeId != null">
                patienttype_id = #{patienttypeId,jdbcType=VARCHAR},
            </if>
            <if test="operationtypeId != null">
                operationtype_id = #{operationtypeId,jdbcType=VARCHAR},
            </if>
            <if test="documentTitle != null">
                document_title = #{documentTitle,jdbcType=VARCHAR},
            </if>
            <if test="documentType != null">
                document_type = #{documentType,jdbcType=VARCHAR},
            </if>
            <if test="operateUser != null">
                operate_user = #{operateUser,jdbcType=VARCHAR},
            </if>
            <if test="operateQide != null">
                operate_aide = #{operateQide,jdbcType=VARCHAR},
            </if>
            <if test="applyUserId != null">
                apply_user_id = #{applyUserId,jdbcType=VARCHAR},
            </if>
            <if test="adminUserId != null">
                admin_user_id = #{adminUserId,jdbcType=VARCHAR},
            </if>
            <if test="qaUserId != null">
                qa_user_id = #{qaUserId,jdbcType=VARCHAR},
            </if>
            <if test="qaTeamId != null">
                qa_team_id = #{qaTeamId,jdbcType=VARCHAR},
            </if>
            <if test="hospitalMemo != null">
                hospital_memo = #{hospitalMemo,jdbcType=VARCHAR},
            </if>
            <if test="qaMemo != null">
                qa_memo = #{qaMemo,jdbcType=VARCHAR},
            </if>
            <if test="adminMemo != null">
                admin_memo = #{adminMemo,jdbcType=VARCHAR},
            </if>
            <if test="memo != null">
                memo = #{memo,jdbcType=VARCHAR},
            </if>
            <if test="documentState != null">
                document_state = #{documentState,jdbcType=VARCHAR},
            </if>
            <if test="operateStartTime != null">
                operate_start_time = #{operateStartTime,jdbcType=VARCHAR},
            </if>
            <if test="operateEndTime != null">
                operate_end_time = #{operateEndTime,jdbcType=VARCHAR},
            </if>
            <if test="hospitalEvaluate != null">
                hospital_evaluate = #{hospitalEvaluate,jdbcType=FLOAT},
            </if>
            <if test="hospitalEvaluateMemo != null">
                hospital_evaluate_memo = #{hospitalEvaluateMemo,jdbcType=VARCHAR},
            </if>
            <if test="doctorEvaluate != null">
                doctor_evaluate = #{doctorEvaluate,jdbcType=FLOAT},
            </if>
            <if test="doctorEvaluateMemo != null">
                doctor_evaluate_memo = #{doctorEvaluateMemo,jdbcType=VARCHAR},
            </if>
            <if test="transferUserId != null">
                transfer_user_id = #{transferUserId,jdbcType=VARCHAR},
            </if>
            <if test="oldDocumentState != null">
                old_document_state = #{oldDocumentState,jdbcType=VARCHAR},
            </if>
            <if test="deleteReason != null">
                delete_reason = #{deleteReason,jdbcType=VARCHAR},
            </if>
		</set>
        where document_id = #{documentId,jdbcType=VARCHAR}
    </update>
    
    <update id="updateTmpDocInfoByMap" parameterType="java.util.Map">
    	insert into WSC_DOCUMENT_TMP(document_id,
									patient_name,
									patient_age,
									patient_sex,
									operative_id,
									anesthetic_id,
									height,
									weight,
									asa,
									xtbs,
									shs,
									shcs,
									sskssj,
									ssjssj,
									sssc,
									jmjs,
									ywsj_hxxt,
									ywsj_hxxt_qt,
									ywsj_xhxt,
									ywsj_xhxt_qt,
									ywsj_gm,
									ywsj_gm_socre,
									ywsj_qt,
									shbl_zw,
									shbl_hbtt,
									shbl_ex,
									shbl_xy,
									shbl_ot,
									shbl_ot_score,
									shttzl,
									photo_1,
									photo_2,
									photo_3,
									photo_4,
									photo_5,
									status)
						values(#{documentId,jdbcType=VARCHAR},
							   #{patientName,jdbcType=VARCHAR},
							   #{patientAge,jdbcType=NUMERIC},
							   #{patientSex,jdbcType=VARCHAR},
							   #{operativeId,jdbcType=VARCHAR},
							   #{anestheticId,jdbcType=VARCHAR},
							   #{height,jdbcType=NUMERIC},
							   #{weight,jdbcType=NUMERIC},
							   #{asa,jdbcType=VARCHAR},
							   #{xtbs,jdbcType=VARCHAR},
							   #{shs,jdbcType=VARCHAR},
							   #{shcs,jdbcType=NUMERIC},
							   #{sskssj,jdbcType=VARCHAR},
							   #{ssjssj,jdbcType=VARCHAR},
							   #{sssc,jdbcType=NUMERIC},
							   #{jmjs,jdbcType=VARCHAR},
							   #{ywsjHxxt,jdbcType=VARCHAR},
							   #{ywsjHxxtQt,jdbcType=VARCHAR},
							   #{ywsjXhxt,jdbcType=VARCHAR},
							   #{ywsjXhxtQt,jdbcType=VARCHAR},
							   #{ywsjGm,jdbcType=VARCHAR},
							   #{ywsjGmAocre,jdbcType=VARCHAR},
							   #{ywsjQt,jdbcType=VARCHAR},
							   #{shblZw,jdbcType=VARCHAR},
							   #{shblHbtt,jdbcType=VARCHAR},
							   #{shblEx,jdbcType=VARCHAR},
							   #{shblXy,jdbcType=VARCHAR},
							   #{shblOt,jdbcType=VARCHAR},
							   #{shblOtScore,jdbcType=NUMERIC},
							   #{shttzl,jdbcType=VARCHAR},
							   #{photo_1,jdbcType=VARCHAR},
							   #{photo_2,jdbcType=VARCHAR},
							   #{photo_3,jdbcType=VARCHAR},
							   #{photo_4,jdbcType=VARCHAR},
							   #{photo_5,jdbcType=VARCHAR},
							   #{status,jdbcType=VARCHAR}
							   ) 
		on duplicate key UPDATE 
				<if test="anestheticId != null and anestheticId != ''" >
            		anesthetic_id = #{anestheticId,jdbcType=VARCHAR},
            	</if>
            	<if test="height != null" >
            		height = #{height,jdbcType=NUMERIC},
            	</if>
            	<if test="weight != null" >
            		weight = #{weight,jdbcType=NUMERIC},
            	</if>
            	<if test="asa != null and asa != ''" >
            		asa = #{asa,jdbcType=VARCHAR},
            	</if>
            	<if test="xtbs != null and xtbs != ''" >
            		xtbs = #{xtbs,jdbcType=VARCHAR},
            	</if>
            	<if test="shs != null and shs != ''" >
            		shs = #{shs,jdbcType=VARCHAR},
            	</if>
            	<if test="shcs != null ">
            		shcs = #{shcs,jdbcType=NUMERIC},
            	</if>
            	<if test="sskssj != null and sskssj != ''" >
            		sskssj = #{sskssj,jdbcType=VARCHAR},
            	</if>
            	<if test="ssjssj != null and ssjssj != ''" >
            		ssjssj = #{ssjssj,jdbcType=VARCHAR},
            	</if>
            	<if test="sssc != null" >
            		sssc = #{sssc,jdbcType=NUMERIC},
            	</if>
            	<if test="jmjs != null and jmjs != ''" >
            		jmjs = #{jmjs,jdbcType=VARCHAR},
            	</if>
            	<if test="ywsjHxxt != null and ywsjHxxt != ''" >
            		ywsj_hxxt = #{ywsjHxxt,jdbcType=VARCHAR},
            	</if>
            	<if test="ywsjHxxtQt != null and ywsjHxxtQt != ''" >
            		ywsj_hxxt_qt = #{ywsjHxxtQt,jdbcType=VARCHAR},
            	</if>
            	<if test="ywsjXhxt != null and ywsjXhxt != ''" >
            		ywsj_xhxt = #{ywsjXhxt,jdbcType=VARCHAR},
            	</if>
            	<if test="ywsjHxxtQt != null and ywsjHxxtQt != ''" >
            		ywsj_xhxt_qt = #{ywsjHxxtQt,jdbcType=VARCHAR},
            	</if>
            	<if test="ywsjXhxt != null and ywsjXhxt != ''" >
            		ywsj_xhxt = #{ywsjXhxt,jdbcType=VARCHAR},
            	</if>
            	<if test="ywsjXhxtQt != null and ywsjXhxtQt != ''" >
            		ywsj_xhxt_qt = #{ywsjXhxtQt,jdbcType=VARCHAR},
            	</if>
            	<if test="ywsjGm != null and ywsjGm != ''" >
            		ywsj_gm = #{ywsjGm,jdbcType=VARCHAR},
            	</if>
            	<if test="ywsjGmAocre != null and ywsjGmAocre != ''" >
            		ywsj_gm_socre = #{ywsjGmAocre,jdbcType=VARCHAR},
            	</if>
            	<if test="ywsjQt != null and ywsjQt != ''" >
            		ywsj_qt = #{ywsjQt,jdbcType=VARCHAR},
            	</if>
            	<if test="shblZw != null and shblZw != ''" >
            		shbl_zw = #{shblZw,jdbcType=VARCHAR},
            	</if>
            	<if test="shblHbtt != null and shblHbtt != ''" >
            		shbl_hbtt = #{shblHbtt,jdbcType=VARCHAR},
            	</if>
            	<if test="shblEx != null and shblEx != ''" >
            		shbl_ex = #{shblEx,jdbcType=VARCHAR},
            	</if>
            	<if test="shblXy != null and shblXy != ''" >
            		shbl_xy = #{shblXy,jdbcType=VARCHAR},
            	</if>
            	<if test="shblOt != null and shblOt != ''" >
            		shbl_ot = #{shblOt,jdbcType=VARCHAR},
            	</if>
            	<if test="shblOtScore != null " >
            		shbl_ot_score = #{shblOtScore,jdbcType=NUMERIC},
            	</if>
            	<if test="shttzl != null and shttzl != ''" >
            		shttzl = #{shttzl,jdbcType=VARCHAR},
            	</if>
            	<if test="photo_1 != null" >
            		photo_1 = #{photo_1,jdbcType=VARCHAR},
            	</if>
            	<if test="photo_2 != null" >
            		photo_2 = #{photo_2,jdbcType=VARCHAR},
            	</if>
            	<if test="photo_3 != null" >
            		photo_3 = #{photo_3,jdbcType=VARCHAR},
            	</if>
            	<if test="photo_4 != null" >
            		photo_4 = #{photo_4,jdbcType=VARCHAR},
            	</if>
            	<if test="photo_5 != null" >
            		photo_5 = #{photo_5,jdbcType=VARCHAR},
            	</if>
            	status = #{status,jdbcType=VARCHAR}
    </update>
    
    <update id="updateTmpDocInfoByMapOnlyState" parameterType="java.util.Map">
		update WSC_DOCUMENT_TMP 
		set status = #{status,jdbcType=VARCHAR} 
		where document_id = #{documentId,jdbcType=VARCHAR} 
    </update>
    
    <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    	delete from WSC_DOCUMENT where document_id = #{documentId,jdbcType=VARCHAR}
    </delete>
    
    <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String">
    	select 
    	<include refid="Base_Column_List"/>
    	from WSC_DOCUMENT 
    	where document_id = #{documentId,jdbcType=VARCHAR}
    </select>
    
    <select id="selectWebScDocList" parameterType="com.sc.mp.model.WebScDoc" resultMap="BaseResultMap">
     <![CDATA[
    select  document_id,
    		operative_id,
			(select GROUP_CONCAT(operative_name) 
			from WSC_OPERATIVE 
			where operative_id in (
				(
					select 
					substring_index(substring_index(tmpTab.operative_id, ',' , help_topic_id + 1), ',' , -1) 
					from mysql.help_topic 
					where help_topic_id < (length(tmpTab.operative_id) - length(REPLACE(tmpTab.operative_id, ',', '')) + 1 )
				)
			)) as operative_name,
			anesthetic_id,
			anesthetic_name,
			patient_name,
			patient_age,
			patient_sex,
    		
            tmp_operative_id,
			(select GROUP_CONCAT(operative_name) 
			from WSC_OPERATIVE 
			where operative_id in (
				(
					select 
					substring_index(substring_index(tmpTab.tmp_operative_id, ',' , help_topic_id + 1), ',' , -1) 
					from mysql.help_topic 
					where help_topic_id < (length(tmpTab.tmp_operative_id) - length(REPLACE(tmpTab.tmp_operative_id, ',', '')) + 1 )
				)
			)) as tmp_operative_name,
			tmp_anesthetic_id,
			tmp_anesthetic_name,
			tmp_patient_name,
			tmp_patient_age,
			tmp_patient_sex,
			
			patient_num,
			patient_bednum,
			patienttype_id,
			operationtype_id,
			document_title,
			document_type,
			operate_user,
			operate_aide,
			apply_user_id,
			apply_user_name,
			admin_user_id,
			admin_user_name,
			qa_user_id,
			qa_user_name,
			qa_team_id,
			hospital_memo,
			qa_memo,
			admin_memo,
			memo,
			document_state,
			operate_start_time,
			operate_end_time,
			create_date,
			hospital_evaluate,
			hospital_evaluate_memo,
			doctor_evaluate,
			doctor_evaluate_memo,
			old_document_state,
			delete_reason,
			transfer_user_id,
			
			org_id,
			org_name,
			org_address,
			org_tel,
			leader_name,
			leader_tel,
			org_province,
			org_city,
			org_area,
			
			height,
			weight,
			asa,
			xtbs,
			shs,
			shcs,
			sskssj,
			ssjssj,
			sssc,
			jmjs,
			ywsj_hxxt,
			ywsj_hxxt_qt,
			ywsj_xhxt,
			ywsj_xhxt_qt,
			ywsj_gm,
			ywsj_gm_socre,
			ywsj_qt,
			shbl_zw,
			shbl_hbtt,
			shbl_ex,
			shbl_xy,
			shbl_ot,
			shbl_ot_score,
			shttzl,
			photo_1,
			photo_2,
			photo_3,
			photo_4,
			photo_5,
			status 
	 from (
    	select 
    		doc.document_id,
    		doc.operative_id,
			doc.anesthetic_id,
			(select anesthetic_name from WSC_ANESTHETIC where anesthetic_id = doc.anesthetic_id) as anesthetic_name,
			doc.patient_name,
			doc.patient_age,
			doc.patient_sex,
    		
            doctmp.operative_id as tmp_operative_id,
			doctmp.anesthetic_id as tmp_anesthetic_id,
			(select anesthetic_name from WSC_ANESTHETIC where anesthetic_id = doctmp.anesthetic_id) as tmp_anesthetic_name,
			doctmp.patient_name as tmp_patient_name,
			doctmp.patient_age as tmp_patient_age,
			doctmp.patient_sex as tmp_patient_sex,
			
			doc.patient_num,
			doc.patient_bednum,
			doc.patienttype_id,
			doc.operationtype_id,
			doc.document_title,
			doc.document_type,
			doc.operate_user,
			doc.operate_aide,
			doc.apply_user_id,
			(select user_name from WSC_USER where user_id = doc.apply_user_id) as apply_user_name,
			doc.admin_user_id,
			(select user_name from WSC_USER where user_id = doc.apply_user_id) as admin_user_name,
			doc.qa_user_id,
			(select user_name from WSC_USER where user_id = doc.qa_user_id) as qa_user_name,
			doc.qa_team_id,
			doc.hospital_memo,
			doc.qa_memo,
			doc.admin_memo,
			doc.memo,
			doc.document_state,
			doc.operate_start_time,
			doc.operate_end_time,
			DATE_FORMAT(doc.create_date, '%Y-%m-%d %H:%k:%s') as create_date,
			doc.hospital_evaluate,
			doc.hospital_evaluate_memo,
			doc.doctor_evaluate,
			doc.doctor_evaluate_memo,
			doc.old_document_state,
			doc.delete_reason,
			doc.transfer_user_id,
			
			doc.org_id,
			org.org_name,
			org.org_address,
			org.org_tel,
			org.leader_name,
			org.leader_tel,
			org.province as org_province,
			org.city as org_city,
			org.area as org_area,
			
			doctmp.height,
			doctmp.weight,
			doctmp.asa,
			doctmp.xtbs,
			doctmp.shs,
			doctmp.shcs,
			doctmp.sskssj,
			doctmp.ssjssj,
			doctmp.sssc,
			doctmp.jmjs,
			doctmp.ywsj_hxxt,
			doctmp.ywsj_hxxt_qt,
			doctmp.ywsj_xhxt,
			doctmp.ywsj_xhxt_qt,
			doctmp.ywsj_gm,
			doctmp.ywsj_gm_socre,
			doctmp.ywsj_qt,
			doctmp.shbl_zw,
			doctmp.shbl_hbtt,
			doctmp.shbl_ex,
			doctmp.shbl_xy,
			doctmp.shbl_ot,
			doctmp.shbl_ot_score,
			doctmp.shttzl,
			doctmp.photo_1,
			doctmp.photo_2,
			doctmp.photo_3,
			doctmp.photo_4,
			doctmp.photo_5,
			doctmp.status 
    	from WSC_DOCUMENT doc 
    	left join WSC_DOCUMENT_TMP doctmp on doc.document_id = doctmp.document_id 
    	left join WSC_ORGANIZATION org on doc.org_id = org.org_id 
    	where 1=1 
    	]]>	
      	<if test="roleId != null and roleId == '2' and applyUserId != null">
    		<![CDATA[
      			and (	
      					org.org_id in (
	      					select org_id 
	      					from WSC_USER t_u 
	      					left join WSC_ORGANIZATION t_o on t_u.role_type_id = t_o.org_pid 
	      					where t_u.user_id = #{applyUserId,jdbcType=VARCHAR} 
	      				) or org.org_id in (
	      					select role_type_id from WSC_USER where user_id = #{applyUserId,jdbcType=VARCHAR} 
	      				)
      				)
      		]]>		
    	</if>
    	<if test="roleId != null and roleId == '4' and qaUserId != null">
    		<![CDATA[
      			and (
      					doc.qa_user_id = #{qaUserId,jdbcType=VARCHAR} 
      					or 
      					doc.document_id in
      					(
	      					select doc.document_id 
	      					from WSC_QATEAM wq 
	      					where wq.user_id = #{qaUserId,jdbcType=VARCHAR} 
	      					and wq.team_id = doc.qa_team_id 
      					)
      				)
      		]]>		
    	</if>
    	<if test="province != null">
      		and org.province = #{province,jdbcType=VARCHAR} 
      	</if>
      	<if test="city != null and city != ''">
      		and org.city = #{city,jdbcType=VARCHAR} 
      	</if>
   		<if test="area != null and area != ''">
      		and org.area = #{area,jdbcType=VARCHAR} 
      	</if>
      	<if test="qaUserId != null and qaUserId != ''">
      		and doc.qa_user_id = #{qaUserId,jdbcType=VARCHAR} 
      	</if>
      	<if test="documentState != null">
      		and doc.document_state in (${documentState}) 
      	</if>
      	<if test="documentId != null">
      		and doc.document_id = #{documentId,jdbcType=VARCHAR} 
      	</if>
      	
      	<if test="operateStartTime != null and operateStartTime != ''">
      		<![CDATA[
      		and doc.operate_start_time >= #{operateStartTime,jdbcType=VARCHAR} 
      		]]>	
      	</if>
      	<if test="operateEndTime != null and operateEndTime != ''">
      		<![CDATA[
      		and doc.operate_start_time <= #{operateEndTime,jdbcType=VARCHAR} 
      		]]>	
      	</if>
      	<if test="patientName != null and patientName != ''">
      		and doc.patient_name like concat(#{patientName,jdbcType=VARCHAR}, '%')
      	</if>
      	<if test="doctorEvaluate != null and doctorEvaluate == -1">
      		and doc.doctor_evaluate is not null
      	</if>
      	) tmpTab 
      	where 1=1 
      	<if test="qaUserName != null and qaUserName != ''">
      		and qa_user_name like concat(#{qaUserName,jdbcType=VARCHAR}, '%')
      	</if>
      	order by operate_start_time desc 
      	limit 100
    </select>
    
    <select id="findWebScDocOrg" parameterType="java.lang.String" resultType="com.sc.mp.model.WebScOrganization">
    	select org_id as orgId,
    		   org_pid as orgPid,
    		   org_name as orgName,
    		   org_address as orgAddress,
    		   org_tel as orgTel,
    		   leader_name as leaderName,
    		   leader_tel as leaderTel,
    		   province,
    		   city,
    		   area 
    	from WSC_ORGANIZATION 
    	where org_id in (
    		select org_id from WSC_DOCUMENT where document_id = #{documentId,jdbcType=VARCHAR} 
    	)
    </select>
    
    <select id="getWorkDr" parameterType="java.lang.String" resultType="java.lang.String">
    	select qa_user_id 
    	from WSC_DOCUMENT 
    	where qa_user_id is not null
    	and operate_start_time between str_to_date(#{operate_start_time,jdbcType=VARCHAR}, '%Y-%m-%d') 
		and date_add(str_to_date(#{operate_start_time,jdbcType=VARCHAR}, '%Y-%m-%d'), interval 1 day) 
    </select>
    
    <select id="getDistributionDrGridList" parameterType="java.util.Map" resultMap="BaseResultMap_Fp">
    <![CDATA[
    	select wu.user_id,
    		   wu.user_name,
    		   (select DISTINCT(1) 
    		   	from WSC_RECORD wr
    		   	where wr.user_id = wu.user_id 
    		   	and date_format(wr.record_date, '%Y-%m-%d %h:%i:%s') <= #{operate_start_time,jdbcType=VARCHAR} 
    		   	and date_format(wr.end_date, '%Y-%m-%d %h:%i:%s') >= #{operate_start_time,jdbcType=VARCHAR} 
   		   		and org_id = #{org_id,jdbcType=VARCHAR}
    			) as isrecord,
    		   (
				select DISTINCT(1) 
				from WSC_CALENDAR wc 
				where wc.user_id = wu.user_id 
				and date_format(wc.start_time, '%Y-%m-%d %h:%i:%s') <= #{operate_start_time,jdbcType=VARCHAR} 
				and date_format(wc.end_time, '%Y-%m-%d %h:%i:%s') >= #{operate_start_time,jdbcType=VARCHAR} 
			   ) as iscalendar,
    		   wu.province,
    		   wu.city,
    		   wu.area,
    		   wu.patient_type,
    		   wu.operation_type
    	from WSC_USER wu
    	where role_id = '5'
    	and province = #{province,jdbcType=VARCHAR} 
    ]]>	
    	<if test="city != null">
    		and city = #{city,jdbcType=VARCHAR} 
  		</if>
    	<if test="qaName != null">
    		<![CDATA[
    		and wu.user_name like concat(#{qaName,jdbcType=VARCHAR}, '%')
    		]]>
  		</if>
    </select>
    
    <select id="getTransferUser" parameterType="java.util.Map" resultMap="BaseResultMap_TransferUser">
    	<![CDATA[
    	select distinct wd.qa_user_id as user_id,
    		   wu.user_name,
    		   wu.sex,
    		   wu.age
    	from WSC_DOCUMENT wd 
    	left join WSC_USER wu on wd.qa_user_id = wu.user_id 
    	where str_to_date(wd.operate_start_time, '%Y-%m-%d') = str_to_date(#{operateStartTime,jdbcType=VARCHAR}, '%Y-%m-%d') 
    	and wd.org_id = #{orgId,jdbcType=VARCHAR} 
    	and wd.qa_user_id is not null 
    	and wd.qa_user_id <> #{NoUserId,jdbcType=VARCHAR}
    	]]>
    	<if test="userName != null and userName != ''">
    		<![CDATA[
    		and wu.user_name like concat(#{userName,jdbcType=VARCHAR}, '%')
    		]]>
      	</if>
    </select>
    
    <select id="getQaUserInfo" parameterType="java.util.Map" resultMap="BaseResultMap_TransferUser">
    	<![CDATA[
    	select user_id,
    		   user_name,
    		   sex,
    		   age
    	from WSC_USER
    	where 1=1 
    	and user_id <> #{NoUserId,jdbcType=VARCHAR}
    	and province = #{province,jdbcType=VARCHAR}
    	and role_id = #{roleId,jdbcType=VARCHAR}
    	]]>
    	<if test="userName != null and userName != ''">
      		and user_name = #{userName,jdbcType=VARCHAR} 
      	</if>
    </select>
    
    <select id="statsDay" resultType="Integer">
    	select
           count(1) as count
        from WSC_DOCUMENT
        where operate_start_time LIKE CONCAT(DATE_FORMAT(NOW(),"%Y-%m-%d"), "%")
    </select>
    
    <select id="statsMonth" resultType="Integer">
    	select
            count(1) as count
        from WSC_DOCUMENT
        where operate_start_time LIKE CONCAT(DATE_FORMAT(NOW(),"%Y-%m"), "%")
    </select>
    
    <select id="statsYear" resultType="Integer">
    	select
            count(1) as count
        from WSC_DOCUMENT
        where operate_start_time LIKE CONCAT(DATE_FORMAT(NOW(),"%Y"), "%")
    </select>
    
    <select id="statsTodayForDc" parameterType="java.lang.String" resultType="Integer">
    	SELECT COUNT(1) FROM (
			SELECT * FROM `WSC_DOCUMENT` WHERE qa_user_id = #{userId,jdbcType=VARCHAR} AND document_state <![CDATA[ <> ]]> '6' AND document_state <![CDATA[ <> ]]> '9' AND operate_start_time like CONCAT((DATE_FORMAT(CURDATE(),'%Y-%m-%d')), '%') AND operative_id <![CDATA[ <> ]]> '1879'
			UNION
			SELECT wd.* FROM WSC_DOCUMENT wd, (SELECT team_id FROM WSC_QATEAM WHERE user_id = #{userId,jdbcType=VARCHAR}) wq WHERE wd.qa_team_id = wq.team_id AND wd.document_state <![CDATA[ <> ]]> '6' AND wd.document_state <![CDATA[ <> ]]> '9' AND wd.operate_start_time like CONCAT((DATE_FORMAT(CURDATE(),'%Y-%m-%d')), '%') AND wd.operative_id <![CDATA[ <> ]]> '1879'
		) a
    </select>
    
    <select id="statsWeekForDc" parameterType="java.lang.String" resultType="Integer">
    	SELECT COUNT(1) FROM (
			SELECT * FROM `WSC_DOCUMENT` WHERE qa_user_id = #{userId,jdbcType=VARCHAR} AND document_state <![CDATA[ <> ]]> '6' AND document_state <![CDATA[ <> ]]> '9' AND operate_start_time <![CDATA[ >= ]]> CONCAT(#{mon,jdbcType=VARCHAR}, ' 00:00:00') AND operate_start_time <![CDATA[ <= ]]> CONCAT(#{sun,jdbcType=VARCHAR}, ' 23:59:59') AND operative_id <![CDATA[ <> ]]> '1879'
			UNION
			SELECT wd.* FROM WSC_DOCUMENT wd, (SELECT team_id FROM WSC_QATEAM WHERE user_id = #{userId,jdbcType=VARCHAR}) wq WHERE wd.qa_team_id = wq.team_id AND wd.document_state <![CDATA[ <> ]]> '6' AND wd.document_state <![CDATA[ <> ]]> '9' AND wd.operate_start_time <![CDATA[ >= ]]> CONCAT(#{mon,jdbcType=VARCHAR}, ' 00:00:00') AND wd.operate_start_time <![CDATA[ <= ]]> CONCAT(#{sun,jdbcType=VARCHAR}, ' 23:59:59') AND wd.operative_id <![CDATA[ <> ]]> '1879'
		) a
    </select>
    
    <select id="statsMonthForDc" parameterType="java.lang.String" resultType="Integer">
    	SELECT COUNT(1) FROM (
			SELECT * FROM `WSC_DOCUMENT` WHERE qa_user_id = #{userId,jdbcType=VARCHAR} AND document_state <![CDATA[ <> ]]> '6' AND document_state <![CDATA[ <> ]]> '9' AND operate_start_time like CONCAT((DATE_FORMAT(CURDATE(),'%Y-%m')), '%') AND operative_id <![CDATA[ <> ]]> '1879'
			UNION
			SELECT wd.* FROM WSC_DOCUMENT wd, (SELECT team_id FROM WSC_QATEAM WHERE user_id = #{userId,jdbcType=VARCHAR}) wq WHERE wd.qa_team_id = wq.team_id AND wd.document_state <![CDATA[ <> ]]> '6' AND wd.document_state <![CDATA[ <> ]]> '9' AND wd.operate_start_time like CONCAT((DATE_FORMAT(CURDATE(),'%Y-%m')), '%') AND wd.operative_id <![CDATA[ <> ]]> '1879'
		) a
    </select>
    
    <select id="statsYearForDc" parameterType="java.lang.String" resultType="Integer">
    	SELECT COUNT(1) FROM (
			SELECT * FROM `WSC_DOCUMENT` WHERE qa_user_id = #{userId,jdbcType=VARCHAR} AND document_state <![CDATA[ <> ]]> '6' AND document_state <![CDATA[ <> ]]> '9' AND operate_start_time like CONCAT((DATE_FORMAT(CURDATE(),'%Y')), '%') AND operative_id <![CDATA[ <> ]]> '1879'
			UNION
			SELECT wd.* FROM WSC_DOCUMENT wd, (SELECT team_id FROM WSC_QATEAM WHERE user_id = #{userId,jdbcType=VARCHAR}) wq WHERE wd.qa_team_id = wq.team_id AND wd.document_state <![CDATA[ <> ]]> '6' AND wd.document_state <![CDATA[ <> ]]> '9' AND wd.operate_start_time like CONCAT((DATE_FORMAT(CURDATE(),'%Y')), '%') AND wd.operative_id <![CDATA[ <> ]]> '1879'
		) a
    </select>
    
    <select id="statsByYear" parameterType="java.lang.Integer" resultType="com.sc.mp.bean.OperationCount">
    	select 
    	    MID(monthList.leftMonth, 1, 4) as name,
    	    MID(monthList.leftMonth, 6, 2) as date,
    	    ifnull(doc.num, 0) as count
    	from 
    	    (
    	        SELECT CONCAT(#{thisYear,jdbcType=INTEGER},'-01') AS leftMonth UNION
    	        SELECT CONCAT(#{thisYear,jdbcType=INTEGER},'-02') AS leftMonth UNION
    	        SELECT CONCAT(#{thisYear,jdbcType=INTEGER},'-03') AS leftMonth UNION
    	        SELECT CONCAT(#{thisYear,jdbcType=INTEGER},'-04') AS leftMonth UNION
    	        SELECT CONCAT(#{thisYear,jdbcType=INTEGER},'-05') AS leftMonth UNION
    	        SELECT CONCAT(#{thisYear,jdbcType=INTEGER},'-06') AS leftMonth UNION
    	        SELECT CONCAT(#{thisYear,jdbcType=INTEGER},'-07') AS leftMonth UNION
    	        SELECT CONCAT(#{thisYear,jdbcType=INTEGER},'-08') AS leftMonth UNION
    	        SELECT CONCAT(#{thisYear,jdbcType=INTEGER},'-09') AS leftMonth UNION
    	        SELECT CONCAT(#{thisYear,jdbcType=INTEGER},'-10') AS leftMonth UNION
    	        SELECT CONCAT(#{thisYear,jdbcType=INTEGER},'-11') AS leftMonth UNION
    	        SELECT CONCAT(#{thisYear,jdbcType=INTEGER},'-12') AS leftMonth UNION
    	        SELECT CONCAT(#{lastYear,jdbcType=INTEGER},'-01') AS leftMonth UNION
    	        SELECT CONCAT(#{lastYear,jdbcType=INTEGER},'-02') AS leftMonth UNION
    	        SELECT CONCAT(#{lastYear,jdbcType=INTEGER},'-03') AS leftMonth UNION
    	        SELECT CONCAT(#{lastYear,jdbcType=INTEGER},'-04') AS leftMonth UNION
    	        SELECT CONCAT(#{lastYear,jdbcType=INTEGER},'-05') AS leftMonth UNION
    	        SELECT CONCAT(#{lastYear,jdbcType=INTEGER},'-06') AS leftMonth UNION
    	        SELECT CONCAT(#{lastYear,jdbcType=INTEGER},'-07') AS leftMonth UNION
    	        SELECT CONCAT(#{lastYear,jdbcType=INTEGER},'-08') AS leftMonth UNION
    	        SELECT CONCAT(#{lastYear,jdbcType=INTEGER},'-09') AS leftMonth UNION
    	        SELECT CONCAT(#{lastYear,jdbcType=INTEGER},'-10') AS leftMonth UNION
    	        SELECT CONCAT(#{lastYear,jdbcType=INTEGER},'-11') AS leftMonth UNION
    	        SELECT CONCAT(#{lastYear,jdbcType=INTEGER},'-12') AS leftMonth UNION
    	        SELECT CONCAT(#{beforeLastYear,jdbcType=INTEGER},'-01') AS leftMonth UNION
    	        SELECT CONCAT(#{beforeLastYear,jdbcType=INTEGER},'-02') AS leftMonth UNION
    	        SELECT CONCAT(#{beforeLastYear,jdbcType=INTEGER},'-03') AS leftMonth UNION
    	        SELECT CONCAT(#{beforeLastYear,jdbcType=INTEGER},'-04') AS leftMonth UNION
    	        SELECT CONCAT(#{beforeLastYear,jdbcType=INTEGER},'-05') AS leftMonth UNION
    	        SELECT CONCAT(#{beforeLastYear,jdbcType=INTEGER},'-06') AS leftMonth UNION
    	        SELECT CONCAT(#{beforeLastYear,jdbcType=INTEGER},'-07') AS leftMonth UNION
    	        SELECT CONCAT(#{beforeLastYear,jdbcType=INTEGER},'-08') AS leftMonth UNION
    	        SELECT CONCAT(#{beforeLastYear,jdbcType=INTEGER},'-09') AS leftMonth UNION
    	        SELECT CONCAT(#{beforeLastYear,jdbcType=INTEGER},'-10') AS leftMonth UNION
    	        SELECT CONCAT(#{beforeLastYear,jdbcType=INTEGER},'-11') AS leftMonth UNION
    	        SELECT CONCAT(#{beforeLastYear,jdbcType=INTEGER},'-12') AS leftMonth
    	    ) monthList
    	left join
    	    (select count(1) as num, MID(operate_start_time, 1, 7) rightMonth from WSC_DOCUMENT GROUP BY rightMonth) doc
    	    on monthList.leftMonth = doc.rightMonth
    	    order by monthList.leftMonth
    </select>
    
    <select id="xcxStatsByWeekForOrgan" parameterType="java.lang.String" resultType="com.sc.mp.bean.OperationCount">
    	SELECT
    		<if test="orgName != null and orgName != ''">
    	    	#{orgName,jdbcType=VARCHAR} as name,
    	    </if>
    	    dayList.leftWeek as date,
    	    ifnull(doc.num, 0) as count
    	FROM 
    	<choose>
    		<when test="sunday == '0'">
    			(
	    	        SELECT SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') + 6) AS leftDay, concat_ws('/',DATE_FORMAT(SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') + 6),'%m-%d'),'一') AS leftWeek UNION
				    SELECT SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') + 5) AS leftDay, concat_ws('/',DATE_FORMAT(SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') + 5),'%m-%d'),'二') AS leftWeek UNION
				    SELECT SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') + 4) AS leftDay, concat_ws('/',DATE_FORMAT(SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') + 4),'%m-%d'),'三') AS leftWeek UNION
				    SELECT SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') + 3) AS leftDay, concat_ws('/',DATE_FORMAT(SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') + 3),'%m-%d'),'四') AS leftWeek UNION
				    SELECT SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') + 2) AS leftDay, concat_ws('/',DATE_FORMAT(SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') + 2),'%m-%d'),'五') AS leftWeek UNION
			    	SELECT SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') + 1) AS leftDay, concat_ws('/',DATE_FORMAT(SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') + 1),'%m-%d'),'六') AS leftWeek UNION
			    	SELECT SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w')) AS leftDay, concat_ws('/',DATE_FORMAT(SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w')),'%m-%d'),'日') AS leftWeek
	            ) dayList
    		</when>
    		<otherwise>
    			(
	    	        SELECT SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') - 1) AS leftDay, concat_ws('/',DATE_FORMAT(SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') - 1),'%m-%d'),'一') AS leftWeek UNION
			    	SELECT SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') - 2) AS leftDay, concat_ws('/',DATE_FORMAT(SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') - 2),'%m-%d'),'二') AS leftWeek UNION
			    	SELECT SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') - 3) AS leftDay, concat_ws('/',DATE_FORMAT(SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') - 3),'%m-%d'),'三') AS leftWeek UNION
			    	SELECT SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') - 4) AS leftDay, concat_ws('/',DATE_FORMAT(SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') - 4),'%m-%d'),'四') AS leftWeek UNION
			    	SELECT SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') - 5) AS leftDay, concat_ws('/',DATE_FORMAT(SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') - 5),'%m-%d'),'五') AS leftWeek UNION
		    		SELECT SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') - 6) AS leftDay, concat_ws('/',DATE_FORMAT(SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') - 6),'%m-%d'),'六') AS leftWeek UNION
			    	SELECT SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') - 7) AS leftDay, concat_ws('/',DATE_FORMAT(SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') - 7),'%m-%d'),'日') AS leftWeek
	            ) dayList
    		</otherwise>
    	</choose>
        LEFT JOIN
    	    (
    	        SELECT
    	          count(1) as num, MID(operate_start_time, 1, 10) rightDay, org_id
    	        FROM
    	          WSC_DOCUMENT
    	        WHERE org_id = #{orgId,jdbcType=VARCHAR}
    	        GROUP BY rightDay, org_id) doc
    	        ON dayList.leftDay = doc.rightDay
    	        ORDER BY dayList.leftDay
    </select>
    
    <select id="statsByWeekForOrgan" parameterType="java.lang.String" resultType="com.sc.mp.bean.OperationCount">
    	SELECT
    		<if test="orgName != null and orgName != ''">
    	    	#{orgName,jdbcType=VARCHAR} as name,
    	    </if>
    	    dayList.leftWeek as date,
    	    ifnull(doc.num, 0) as count
    	FROM 
    	<choose>
    		<when test='sunday == "0"'>
    			(
	    	        SELECT SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') + 6) AS leftDay, '一' AS leftWeek UNION
				    SELECT SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') + 5) AS leftDay, '二' AS leftWeek UNION
				    SELECT SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') + 4) AS leftDay, '三' AS leftWeek UNION
				    SELECT SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') + 3) AS leftDay, '四' AS leftWeek UNION
				    SELECT SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') + 2) AS leftDay, '五' AS leftWeek UNION
			    	SELECT SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') + 1) AS leftDay, '六' AS leftWeek UNION
			    	SELECT SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w')) AS leftDay, '日' AS leftWeek
	            ) dayList
    		</when>
    		<otherwise>
    			(
	    	        SELECT SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') - 1) AS leftDay, '一' AS leftWeek UNION
			    	SELECT SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') - 2) AS leftDay, '二' AS leftWeek UNION
			    	SELECT SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') - 3) AS leftDay, '三' AS leftWeek UNION
			    	SELECT SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') - 4) AS leftDay, '四' AS leftWeek UNION
			    	SELECT SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') - 5) AS leftDay, '五' AS leftWeek UNION
		    		SELECT SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') - 6) AS leftDay, '六' AS leftWeek UNION
			    	SELECT SUBDATE(CURDATE(),DATE_FORMAT(CURDATE(),'%w') - 7) AS leftDay, '日' AS leftWeek
	            ) dayList
    		</otherwise>
    	</choose>
        LEFT JOIN
    	    (
    	        SELECT
    	          count(1) as num, MID(operate_start_time, 1, 10) rightDay, org_id
    	        FROM
    	          WSC_DOCUMENT
    	        WHERE org_id = #{orgId,jdbcType=VARCHAR}
    	        GROUP BY rightDay, org_id) doc
    	        ON dayList.leftDay = doc.rightDay
    	        ORDER BY dayList.leftDay
    </select>
    
    <select id="statsByMonthForOrgan" parameterType="java.lang.String" resultType="com.sc.mp.bean.OperationCount">
    	SELECT
    		<if test="orgName != null and orgName != ''">
    	    	#{orgName,jdbcType=VARCHAR} as name,
    	    </if>
    	    MID(dayList.leftDay, 9, 2) as date,
    	    ifnull(doc.num, 0) as count
    	FROM 
    	    (
    	        SELECT
                  date_add(CONCAT(YEAR(Date(curdate())),'-0',MONTH(Date(curdate())),'-','01'),
                  INTERVAL(cast(help_topic_id AS signed INTEGER)) DAY) leftDay
                FROM
                  mysql.help_topic
                WHERE
                  help_topic_id <![CDATA[ < ]]> day(last_day(curdate()))
                ORDER BY
                  help_topic_id
            ) dayList
    	LEFT JOIN
    	    (
    	        SELECT
    	          count(1) as num, MID(operate_start_time, 1, 10) rightDay, org_id
    	        FROM
    	          WSC_DOCUMENT
    	        WHERE org_id = #{orgId,jdbcType=VARCHAR}
    	        GROUP BY rightDay, org_id) doc
    	        ON dayList.leftDay = doc.rightDay
    	        ORDER BY dayList.leftDay
    </select>
    
    <select id="statsByYearForOrgan" parameterType="java.lang.String" resultType="com.sc.mp.bean.OperationCount">
    	select
    		<if test="orgName != null and orgName != ''">
    	    	#{orgName,jdbcType=VARCHAR} as name,
    	    </if>
    	    MID(monthList.leftMonth, 6, 2) as date,
    	    ifnull(doc.num, 0) as count
    	from 
    	    (
    	        SELECT CONCAT(YEAR(Date(curdate())),'-01') AS leftMonth UNION
    	        SELECT CONCAT(YEAR(Date(curdate())),'-02') AS leftMonth UNION
    	        SELECT CONCAT(YEAR(Date(curdate())),'-03') AS leftMonth UNION
    	        SELECT CONCAT(YEAR(Date(curdate())),'-04') AS leftMonth UNION
    	        SELECT CONCAT(YEAR(Date(curdate())),'-05') AS leftMonth UNION
    	        SELECT CONCAT(YEAR(Date(curdate())),'-06') AS leftMonth UNION
    	        SELECT CONCAT(YEAR(Date(curdate())),'-07') AS leftMonth UNION
    	        SELECT CONCAT(YEAR(Date(curdate())),'-08') AS leftMonth UNION
    	        SELECT CONCAT(YEAR(Date(curdate())),'-09') AS leftMonth UNION
    	        SELECT CONCAT(YEAR(Date(curdate())),'-10') AS leftMonth UNION
    	        SELECT CONCAT(YEAR(Date(curdate())),'-11') AS leftMonth UNION
    	        SELECT CONCAT(YEAR(Date(curdate())),'-12') AS leftMonth
    	    ) monthList
    	left join
    	    (select count(1) as num, MID(operate_start_time, 1, 7) rightMonth from WSC_DOCUMENT
    	    WHERE org_id = #{orgId,jdbcType=VARCHAR}
    	    GROUP BY rightMonth) doc
    	    on monthList.leftMonth = doc.rightMonth
    	    order by monthList.leftMonth
    </select>
    
    <select id="statsByCity" parameterType="java.lang.Integer" resultType="com.sc.mp.bean.OperationCount">
        (SELECT COUNT(1) as count, wo.city as cityCode
        FROM
        `WSC_DOCUMENT` wd, WSC_ORGANIZATION wo
        WHERE wd.org_id = wo.org_id and (year(wd.operate_start_time) = year(now()))
        GROUP BY wo.city ORDER BY count DESC LIMIT #{top,jdbcType=INTEGER})
        UNION
        (SELECT IFNULL(SUM(t.c),0) as count, '86' as cityCode
        FROM
        ((SELECT COUNT(1) as c, wo.city as cCode
        FROM
        `WSC_DOCUMENT` wd, WSC_ORGANIZATION wo
        WHERE wd.org_id = wo.org_id and (year(wd.operate_start_time) = year(now()))
        GROUP BY wo.city ORDER BY c DESC LIMIT #{top,jdbcType=INTEGER}, 9999)) t)
    </select>
    <!--  or year(wd.operate_start_time) = year(date_sub(now(),interval 1 year)) -->
    
    <select id="selectReporting" parameterType="java.util.Map" resultType="com.sc.mp.bean.OperationCount">
	     SELECT
	     	leftTable.orgId,
	     	ifnull(rightTable.org_name, 'ALL_ORGANIZATION') as orgName,
	     	leftTable.count
	     FROM  
	        (SELECT
	            ifnull(wd.org_id, 'zzzzzzzz_allOrgId') as orgId,
	            COUNT(1) as count
	        FROM `WSC_DOCUMENT` wd
	        <where>
	        	<choose>
	        		<when test="params.orgId != null and params.orgId != ''">
	        			AND wd.org_id = #{params.orgId,jdbcType=VARCHAR}
	        		</when>
	        		<otherwise>
	        			<choose>
	        				<when test="params.area != null and params.area != ''">
	        					AND wd.org_id in (SELECT org_id FROM WSC_ORGANIZATION WHERE area = #{params.area,jdbcType=VARCHAR} AND leaf = 1)
	        				</when>
	        				<otherwise>
	        					<choose>
	        						<when test="params.city != null and params.city != ''">
	        							AND wd.org_id in (SELECT org_id FROM WSC_ORGANIZATION WHERE city = #{params.city,jdbcType=VARCHAR} AND leaf = 1)
	        						</when>
	        						<otherwise>
	        							<choose>
	        								<when test="params.province != null and params.province != ''">
	        									AND wd.org_id in (SELECT org_id FROM WSC_ORGANIZATION WHERE province = #{params.province,jdbcType=VARCHAR} AND leaf = 1)
	        								</when>
	        							</choose>
	        						</otherwise>
	        					</choose>
	        				</otherwise>
	        			</choose>
	        		</otherwise>
	        	</choose>
	        	<if test="params.userId != null and params.userId != ''">
	        		AND (wd.qa_user_id = #{params.userId,jdbcType=VARCHAR} or wd.qa_team_id in (select team_id from WSC_QATEAM where user_id = #{params.userId,jdbcType=VARCHAR}))
	        	</if>
	        	<if test="params.beginTime != null and params.beginTime != ''">
	        		AND wd.operate_start_time <![CDATA[ >= ]]> CONCAT(#{params.beginTime,jdbcType=VARCHAR}, ' 00:00:00')
	        	</if>
	        	<if test="params.endTime != null and params.endTime != ''">
	        		AND wd.operate_start_time <![CDATA[ <= ]]> CONCAT(#{params.endTime,jdbcType=VARCHAR}, ' 23:59:59')
	        	</if>
	        	AND wd.document_state = '5' GROUP BY wd.org_id WITH ROLLUP
	        </where>) as leftTable
		left join
			WSC_ORGANIZATION as rightTable
		on leftTable.orgId = rightTable.org_id
		order by leftTable.count desc, leftTable.orgId desc
    </select>
    
</mapper>