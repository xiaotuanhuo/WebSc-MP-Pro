<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1,minimum-scale=1.0, maximum-scale=1.0,user-scalable=no" />
    <title></title>
	<link rel="stylesheet" th:href="@{/css/mzui.min.css}">
    <link th:href="@{/css/common.css}" rel="stylesheet">
    <link th:href="@{/css/datePlugin/mobiscroll_002.css}" rel="stylesheet">
    <link th:href="@{/css/datePlugin/mobiscroll.css}" rel="stylesheet">
    <link th:href="@{/css/datePlugin/mobiscroll_003.css}" rel="stylesheet">
	<link th:href="@{/css/star.css}" rel="stylesheet">
	<link rel="stylesheet" th:href="@{/css/viewer.min.css}">
	<link rel="stylesheet" th:href="@{/lib/layui/css/layui.css}">
	
    <style type="text/css">
    	body::-webkit-scrollbar{
        	display: none;
    	}
    	
    	.layui-m-layer *::-webkit-scrollbar{
        	display: none;
    	}
    	
    	.scroll-wrapper {  
		    -webkit-overflow-scrolling: touch;  
		    overflow-y: scroll;  
		}
		.row {
			margin: 0; 
		}
		/*医生界面提交用*/
		.drwd_row{
			font-size: .7rem;
/* 		    font-weight: 700; */
		    padding: 0 15 0 15;
		}
		.drwd_input{
			width:auto;
			height: 26px;
			min-height:26px;
			flex:auto;
			padding:0 5 0 5;
/* 			font-weight: 700; */
		}
		.checkbox>input+label{
		    padding-left: 1.5rem;
		}
		@keyframes fade {
		    from {
		        opacity: 1.0;
		    }
		    50% {
		        opacity: 0.4;
		    }
		    to {
		        opacity: 1.0;
		    }
		}
		
		@-webkit-keyframes fade {
		    from {
		        opacity: 1.0;
		    }
		    50% {
		        opacity: 0.4;
		    }
		    to {
		        opacity: 1.0;
		    }
		}
		
		.addBox {
			width:310px;
		    height: 120px;
		    background-color:white;
		    border: 1px dashed #aaa;
		    border-radius: 4px;
		    text-align: center;
		    padding: 25px 0 25px 0;
		    cursor: pointer;
		}
		
		.addBox:hover{
			animation: fade 600ms infinite;
		    -webkit-animation: fade 600ms infinite;
		}
		.myradio {
 			box-sizing:inherit
		}
</style>
</head>
<body class="bodgray" >
	<div class="heading">
		<nav class="nav" style="width: 100%;padding-right: 10px;background-image: linear-gradient(-12deg,#8470FF 0,#6495ED 100%) !important; color:white;padding-top: 4px;">
			<div class="cell">
				<a onclick="onHtmlBack()">
					<span style="padding: 0 10px;height: 40px;line-height: 40px;font-size: 16px;font-weight: 400;border-radius: 5px 5px 0 0;text-align: center;color: white;">
						<i class="icon icon-chevron-left"></i>&nbsp;&nbsp;订单详情
					</span>
				</a>	
			</div>
		</nav>
	</div>
	
	<div id="navDoc" class="container display fade in" data-display-name="navs">
		<input id="docId" type="hidden" th:value="${doc.documentId}"></input>
		<input id="documentState" type="hidden" th:value="${doc.documentState}"></input>
		<input id="oldDocumentState" type="hidden" th:value="${doc.oldDocumentState}"></input>
		
		<input id="photoCount" type="hidden" name="photo" />
		<input id="photoIdx" type="hidden" name="photo" />
		<!-- 患者信息   -->
		<div class='heading'>
			<div class='title'><strong>患者信息</strong></div>
	  	</div>
		<div class="list section rounded-lg" style="margin-bottom: 0px;">
			<div class="row" style="padding: 20px 20px 0 20px;">
				<div class="row" style="padding: 0 20px 0 20px;">
					<div class="cell-9"><h2><span th:text="${doc.patientName}"></span></h2></div>
				</div>
				<div id="tag_state" class="cell-3 row-reverse" style="text-align: right;">
					<div class="pull-right label red-pale text-tint" th:if="${doc.documentState=='0'}">待审核</div>
					<div class="pull-right label red-pale text-tint" th:if="${doc.documentState=='1'}">待分配</div>
					<div class="pull-right label red-pale text-tint" th:if="${user.roleId=='4' && doc.documentState=='2'}">已匹配</div>
					<div class="pull-right label red-pale text-tint" th:if="${user.roleId=='5' && doc.documentState=='2'}">待接单</div>
					<div class="pull-right label red-pale text-tint" th:if="${doc.documentState=='3' && doc.oldDocumentState != '4'}">待手术</div>
					<div class="pull-right label red-pale text-tint" th:if="${doc.documentState=='3' && doc.oldDocumentState == '4'}">退回修改</div>
					<div class="pull-right label red-pale text-tint" th:if="${doc.documentState=='4'}">待完成</div>
					<div class="pull-right label green-pale text-tint" th:if="${doc.documentState=='5'}">已完成</div>
					<div class="pull-right label red-pale text-tint" th:if="${doc.documentState=='9'}">待取消</div>
				</div>
			</div>
			<div class="row" style="padding: 0 0 0 25px;">
				<span class="small text-green" th:text="${doc.operateStartTime}" style="margin-right: 20px;"></span>
				<input id="title_applyUserId" type="hidden" th:value="${doc.applyUserId}">
				<span class="small" th:text="${doc.applyUserName}"></span>
			</div>
			<hr>
			<div class="row" style="padding: 0 20px 0 20px;">
				<table class="patient_table">
					<tr>
      					<th class="title">手术名称：</th>
      					<th class="patient_mainval"><span th:text="${doc.operativeName}"></span></th>
    				</tr>
    				<tr>
      					<th class="title">性别：</th>
      					<th class="patient_val"><span th:text="${doc.patientSex == '0'? '女':'男'}"></span></th>
    				</tr>
    				<tr>
      					<th class="title">年龄：</th>
      					<th class="patient_val"><span th:text="${doc.patientAge}"></span></th>
    				</tr>
    				<tr>
      					<th class="title">诊断：</th>
      					<th class="patient_val"><span th:text="${doc.documentTitle}"></span></th>
    				</tr>
    				<tr>
      					<th class="title">手术医生：</th>
      					<th class="patient_val"><span th:text="${doc.operateUser}"></span></th>
    				</tr>
    				<tr>
      					<th class="title">手术助手：</th>
      					<th class="patient_val"><span th:text="${doc.operateQide}"></span></th>
    				</tr>
<!--     				<tr th:if="${doc.documentState > '2'}"> -->
<!--       					<th class="title">麻醉医生：</th> -->
<!--       					<th class="patient_val"><span th:text="${doc.qaUserName}"></span></th> -->
<!--     				</tr> -->
    				<tr>
      					<th class="title">麻醉方法：</th>
      					<th class="patient_val"><span th:text="${doc.anestheticName}"></span></th>
    				</tr>
    				<tr>
      					<th class="title">备注：</th>
      					<th class="patient_val"><span th:text="${doc.memo}"></span></th>
    				</tr>
    				<tr th:if="${doc.documentState > '2'}">
      					<th class="title">医生备注：</th>
      					<th class="patient_val"><span th:text="${doc.qaMemo}"></span></th>
    				</tr>
    				<tr th:if="${doc.documentState == '3' && doc.oldDocumentState == '4'}">
      					<th class="title" style="color: red;">修改备注：</th>
      					<th class="patient_val"><span th:text="${doc.adminMemo}"></span></th>
    				</tr>
    				<tr th:if="${doc.documentState == '9'}">
      					<th class="title" style="color: red;">取消原因：</th>
      					<th class="patient_val"><span th:text="${doc.memo}"></span></th>
    				</tr>
    			</table>
			</div>
		</div>
		
		<div class="heading"  th:if="${doc.documentState > '2'}">
			<div class="title"><strong>麻醉医生</strong></div>
	  	</div>
	  	<div class="list section rounded-lg" th:if="${doc.documentState > '2'}" style="margin-bottom: 0px;">
			<div class="row" style="padding: 10px 20px 0px 20px;">
				<table class="patient_table">
					<tr>
      					<th class="title">医生姓名：</th>
      					<th class="patient_mainval"><span th:text="${doc.qaUserName}"></span></th>
    				</tr>
    			</table>
			</div>
    	</div>
    	
		<!-- 团队   -->
		<div class="heading"  th:if="${doc.documentState > '2'}">
			<div class="title"><strong>团队</strong></div>
	  	</div>
	  	<div class="list section rounded-lg" th:if="${doc.documentState > '2'}" style="margin-bottom: 0px;">
			<div class="row" style="padding: 10px 20px 10px 20px;">
 				<span style="width:80px;padding:5;vertical-align: top;font-size: .7rem;font-weight: bold;">手术团队：</span>
 				<span id="divTeam" style="padding:5px 10px 0px 10px; vertical-align:top;">
	 				<span th:if="${doc.qaTeamId!=null && doc.qaTeamId!=''}" style="font-size: .7rem;"><a style="cursor: pointer;color: blue;" onclick="openTeamView()">团队信息</a></span>
					<span th:if="${doc.qaTeamId==null || doc.qaTeamId==''}" style="font-size: .7rem;">无团队</span>
					<span th:if="${user.roleId=='5' && doc.documentState == '3' && (doc.qaTeamId==null || doc.qaTeamId=='')}" style="font-size: .7rem;">
						<a style="cursor: pointer;color: blue;padding-left: 10px;" onclick="createTeam()">创建</a>
					</span>
				</span>
   			</div>
    	</div>	
    	
		<!-- 手术详情   -->
		<div class="heading"  th:if="${doc.documentState>='4'}">
			<div class="title"><strong>手术详情</strong></div>
	  	</div>
		<div class="list section rounded-lg" th:if="${doc.documentState>='4'}" style="margin-bottom: 0px;">
			<div class="row" style="padding: 10px 20px 0 20px;">
				<table class="patient_table">
					<tr>
	   					<th class="title">身高：</th>
	   					<th class="patient_val"><span th:text="${doc.height}"></span></th>
	  				</tr>
	    			<tr>
	   					<th class="title">体重：</th>
	   					<th class="patient_val"><span th:text="${doc.weight}"></span></th>
	  				</tr>
	  				<tr>
	   					<th class="title">ASA：</th>
	   					<th class="patient_val">
							<span th:if="${doc.asa=='0'}">I 级</span>
							<span th:if="${doc.asa=='1'}">II 级</span>
							<span th:if="${doc.asa=='2'}">III 级</span>
							<span th:if="${doc.asa=='3'}">IV 级</span>
							<span th:if="${doc.asa=='4'}">V 级</span>
							<span th:if="${doc.asa=='5'}">E 级</span>
						</th>
	  				</tr>
	  				<tr>
	   					<th class="title">系统病史：</th>
	   					<th class="patient_val"><span th:text="${doc.xtbs}"></span></th>
	  				</tr>
	  				<tr>
	   					<th class="title">手术史：</th>
	   					<th class="patient_val">
							<span th:if="${doc.shs=='1'}" th:text="${doc.shcs}"></span>
							<span th:if="${doc.shs=='0'}">无</span>
						</th>
	  				</tr>
	  				<tr>
	   					<th class="title">开始时间：</th>
	   					<th class="patient_mainval"><span th:text="${doc.sskssj}"></span></th>
	  				</tr>
	  				<tr>
	   					<th class="title">结束时间：</th>
	   					<th class="patient_mainval"><span th:text="${doc.ssjssj}"></span></th>
	  				</tr>
	  				<tr>
	   					<th class="title">时长：</th>
	   					<th class="patient_mainval"><span th:text="${doc.ssscVal}"></span></th>
	  				</tr>
	  				<tr>
	   					<th class="title">局麻技术：</th>
	   					<th class="patient_val">
							<span th:if="${doc.jmjs=='0'}">好</span>
							<span th:if="${doc.jmjs=='1'}">一般</span>
							<span th:if="${doc.jmjs=='2'}">差</span>
							<span th:if="${doc.jmjs=='3'}">拒绝实施局麻</span>
						</th>
	  				</tr>
    			</table>
			</div>
		</div>
		<!-- 意外事件   -->
		<div class="heading"  th:if="${doc.documentState>='4'}">
			<div class="title"><strong>意外事件</strong></div>
	  	</div>
		<div class="list section rounded-lg" th:if="${doc.documentState>='4'}" style="margin-bottom: 0px;">
			<div class="row" style="padding: 10px 20px 0 20px;">
				<table class="patient_table">
					<tr>
	   					<th class="title">呼吸系统：</th>
	   					<th>
	   						<table>
		   						<tr class="patient_val" th:each="hxxtVal : ${#strings.listSplit(doc.ywsjHxxtVal, ';')}">
	    							<td style="padding: 2; vertical-align: top; font-size: .7rem; font-weight: normal;"><span th:text="${hxxtVal}"></span></td>
								</tr>
	   						</table>
	   					</th>	
	  				</tr>
	    			<tr>
	   					<th class="title" >呼吸其它：</th>
	   					<th class="patient_val"><span th:text="${doc.ywsjHxxtQt}"></span></th>
	  				</tr>
	  				<tr>
	   					<th class="title">循环系统：</th>
	   					<th>
	   						<table>
		   						<tr class="patient_val" th:each="xhxtVal : ${#strings.listSplit(doc.ywsjXhxtVal, ';')}">
	    							<td style="padding: 2; vertical-align: top; font-size: .7rem; font-weight: normal;"><span th:text="${xhxtVal}"></span></td>
								</tr>
	   						</table>
	   					</th>	
	  				<tr>
	   					<th  class="title">循环其它：</th>
	   					<th class="patient_val"><span th:text="${doc.ywsjXhxtQt}"></span></th>
	  				</tr>
	  				<tr>
	   					<th class="title">过敏原：</th>
	   					<th class="patient_val"><span th:text="${doc.ywsjGmAocre}"></span></th>
	  				</tr>
	  				<tr>
	   					<th class="title">其它：</th>
	   					<th class="patient_val"><span th:text="${doc.ywsjQt}"></span></th>
	  				</tr>
    			</table>
			</div>
		</div>
		<!-- 术后反应   -->
		<div class="heading"  th:if="${doc.documentState>='4'}">
			<div class="title"><strong>术后反应</strong></div>
	  	</div>
		<div class="list section rounded-lg" th:if="${doc.documentState>='4'}" style="margin-bottom: 0px;">
			<div class="row" style="padding: 10px 20px 0 20px;">
				<table class="patient_table">
					<tr>
	   					<th class="title">不良反应：</th>
	   					<th class="patient_val">
							<span style="padding-bottom: 5px;" th:if="${doc.shblZw}=='1'">谵妄<br/></span>
							<span style="padding-bottom: 5px;" th:if="${doc.shblHbtt}=='1'">喉部疼痛<br/></span>
							<span style="padding-bottom: 5px;" th:if="${doc.shblXy}=='1'">眩晕<br/></span>
							<span style="padding-bottom: 5px;" th:if="${doc.shblOt}=='1'">呕吐</span>
						</th>
	  				</tr>
	    			<tr>
	   					<th class="title" >疼痛治疗：</th>
	   					<th class="patient_val">
							<span th:if="${doc.shttzl}=='0'"></span>
							<span th:if="${doc.shttzl}=='1'">口服药</span>
							<span th:if="${doc.shttzl}=='2'">静脉推注</span>
							<span th:if="${doc.shttzl}=='3'">静脉镇痛泵</span>
							<span th:if="${doc.shttzl}=='4'">椎管内镇痛泵</span>
							<span th:if="${doc.shttzl}=='5'">无</span>
						</th>
	  				</tr>
    			</table>
			</div>
		</div>
		
		<div class="heading"  th:if="${doc.documentState>='4'}">
			<div class="title"><strong>图片</strong></div>
	  	</div>
		<div class="list section rounded-lg" th:if="${doc.documentState>='4'}" style="margin-bottom: 0px;">
			<table class="patient_table">
  				<tr>
  					<th class="patient_val" >
	  					<div class="layui-upload-list" id="main_photo_list" style="height: 200px;width:-webkit-fill-available;">
	  					</div>
  					</th>
  				</tr>
  			</table>
		</div>	
	  				
		<!-- 评分    -->
		<div class='heading' th:if="${doc.documentState=='5'}">
			<div class='title'><strong>评分</strong></div>
	  	</div>
	  	<div class="list section rounded-lg" th:if="${doc.documentState=='5'}" style="margin-bottom: 50px;">
	  		<div class="row" style="padding: 0 20px 0 20px;" th:if="${user.roleId=='4'}">
	  			<div class="cell-3" style="font-size: .7rem;font-weight: 700;padding-top: 15px;">机构评分:</div>
				<div class="cell-9" style="padding-top: 15px;">
					<input id="hospitalEvaluate" type="hidden" th:value="${doc.hospitalEvaluate}"></input>
					<ul class="star_ul fl" style="margin:0;">
						<li><a id="jg-star-1" class="one-star" title="很差"></a></li>
						<li><a id="jg-star-2" class="two-star" title="差"></a></li>
						<li><a id="jg-star-3" class="three-star" title="还行"></a></li>
						<li><a id="jg-star-4" class="four-star" title="好"></a></li>
						<li><a id="jg-star-5" class="five-star" title="很好"></a></li>
					</ul>
				</div>
	  		</div>
	  		<div class="row" style="padding: 0 20px 0 20px;" th:if="${user.roleId=='4'}">
				<div class="cell-3" style="font-size: .7rem;font-weight: 700;">机构评价:</div>
				<div class="cell-9"><span th:text="${doc.hospitalEvaluateMemo}"></span></div>
			</div>
	  		<div class="row" style="padding: 0 20px 0 20px;" th:if="${user.roleId=='5' || user.roleId=='4'}">
	  			<div class="cell-3" style="font-size: .7rem;font-weight: 700;padding-top: 15px;">医生评分:</div>
				<div class="cell-9" style="padding-top: 15px;">
					<input id="doctorEvaluate" type="hidden" th:value="${doc.doctorEvaluate}"></input>
					<ul class="star_ul fl" style="margin:0;">
						<li><a id="dr-star-1" class="one-star" title="很差"></a></li>
						<li><a id="dr-star-2" class="two-star" title="差"></a></li>
						<li><a id="dr-star-3" class="three-star" title="还行"></a></li>
						<li><a id="dr-star-4" class="four-star" title="好"></a></li>
						<li><a id="dr-star-5" class="five-star" title="很好"></a></li>
					</ul>
				</div>
	  		</div>
	  		<div class="row" style="padding: 0 20px 10px 20px;" th:if="${user.roleId=='5' || user.roleId=='4'}">
				<div class="cell-3" style="font-size: .7rem;font-weight: 700;">医生评价:</div>
				<div class="cell-9"><span th:text="${doc.doctorEvaluateMemo}"></span></div>
			</div>
	  	</div>
	</div>
	
	<nav id="nav_btn" class="nav nav-auto justified" style="padding:30 10 10 10;">
		<button id="btnQx" type="button" class="btn danger outline" style="border-radius:.3rem 0 0 .3rem;" th:if="${user.roleId=='4' && doc.documentState!='0' and doc.documentState!='3' and doc.documentState!='9' and doc.documentState!='4' and doc.documentState!='5' and doc.documentState!='6'}"  onclick="btnQxClick()">取消订单</button>
		
		<button id="btnSh" type="button" class="btn primary" style="border-radius:0 .3rem .3rem 0;" th:if="${user.roleId=='4' && doc.documentState=='0'}">确认订单</button>
		<button id="btnFp" type="button" class="btn primary" style="border-radius:0 .3rem .3rem 0;" th:if="${user.roleId=='4' && doc.documentState=='1'}" onclick="btnFpClick()">订单分配</button>
		<button id="btnQxFp" type="button" class="btn danger" style="border-radius:0 .3rem .3rem 0;" th:if="${user.roleId=='4' && doc.documentState=='2'}" onclick="btnQxFpClick()">取消分配</button>
		
		<button id="btnDoctorQx" type="button" class="btn danger" style="border-radius:.3rem 0 0 .3rem;" th:if="${user.roleId=='5' && doc.documentState=='2'}" onclick="btnDrQxFpClick()">取消订单</button>
		<button id="btnDoctorJd" type="button" class="btn primary" style="border-radius: 0 .3rem .3rem 0;;" th:if="${user.roleId=='5' && doc.documentState=='2'}" onclick="btnDrJdClick()">确认接单</button>
		
		<button id="btnDoctorCx" type="button" class="btn danger" style="border-radius: .3rem 0 0 .3rem;" th:if="${user.roleId=='5' && doc.documentState=='3'}" onclick="recallDoc()">撤销订单</button>
		<button id="btnDoctorZd" type="button" class="btn primary" style="border-radius: 0;" th:if="${user.roleId=='5' && doc.documentState=='3'}" onclick="btnDrZdClick()">转单</button>
		<button id="btnDoctorQr" type="button" class="btn info" style="border-radius: 0 .3rem .3rem 0;" th:if="${user.roleId=='5' && doc.documentState=='3'}" onclick="btnDrQrInfo()">手术完成</button>
		
		<button id="btnQxwc" type="button" class="btn danger outline" style="border-radius:.3rem 0 0 .3rem;" th:if="${user.roleId=='4' && doc.documentState=='4'}" onclick="btnQxwcClick()">退回修改</button>
		<button id="btnQrWc" type="button" class="btn primary" style="border-radius: .3rem;" th:if="${user.roleId=='4' && doc.documentState=='4'}" onclick="btnQrWcClick()">确认完成</button>
		
		<button id="btnQxJj" type="button" class="btn danger" style="border-radius: .3rem 0 0 .3rem;" th:if="${user.roleId=='4' && doc.documentState=='9'}" onclick="btnQxJjClick()">拒绝撤销</button>	
		<button id="btnQxTy" type="button" class="btn primary" style="border-radius: 0 .3rem .3rem 0;" th:if="${user.roleId=='4' && doc.documentState=='9'}" onclick="btnQxTyClick()">同意撤销</button>
		
		<button id="btnDocDf" type="button" class="btn primary" style="border-radius: .3rem;" th:if="${user.roleId=='5' && doc.documentState=='5' && (doc.doctorEvaluate==null || doc.doctorEvaluate==0 ||doc.doctorEvaluate==-1)}" onclick="btnDocDfClick()">评价打分</button>
	</nav>
	
	<!-- 分配 -->
	<div id="pnlFp" class="panel" style="display: none;">
		<div class="panel-body">
			<div class="control flex">
	      		<label for="fp_searchVal" style="width:100px;padding:5 5 5 10;vertical-align: top;font-weight: 700;text-align: right;">医生姓名：</label>
	      		<input class="text" name="fp_searchVal" id="fp_searchVal" value=""/>
	      		<button name="btnSearch" type="button" class="btn btn-small primary hover-solid" style="padding:0;height: 26px;margin-left: 5px;"><i class="icon icon-search"></i></button>
	   		</div>
	   		
	   		<div class="row" style="padding: 0 10px 0 10px;">
				<table id="fp_table" class="table compact striped" style="font-size: .7rem;text-align: center;">
					<thead>
				    	<tr>
				      		<th style="text-align: center;">姓名</th>
				      		<th style="text-align: center;">备案</th>
				      		<th style="text-align: center;">评价</th>
				      		<th style="text-align: center;">操作</th>
			    		</tr>
					</thead>
					<tbody></tbody>
	  			</table>
	  		</div>
   		</div>
	</div>
	
	<!-- 转单(医生) -->
	<div id="pnlZd" class="panel" style="display: none;">
		<div class="panel-body">
			<div class="control flex">
	      		<label for="zd_searchVal" style="width:100px;padding:5 5 5 10;vertical-align: top;font-weight: 700;text-align: right;">医生姓名：</label>
	      		<input class="text" name="zd_searchVal" id="zd_searchVal" value=""/>
	      		<button name="btnSearch" type="button" class="btn btn-small primary hover-solid" style="padding:0;height: 26px;margin-left: 5px;"><i class="icon icon-search"></i></button>
	   		</div>
	   		
	   		<div class="row" style="padding: 0 10px 0 10px;">
				<table id="zd_table" class="table compact striped" style="font-size: .7rem;text-align: center;">
					<thead>
				    	<tr>
				      		<th style="text-align: center;">姓名</th>
				      		<th style="text-align: center;">年龄</th>
				      		<th style="text-align: center;">性别</th>
				      		<th style="text-align: center;">操作</th>
			    		</tr>
					</thead>
					<tbody></tbody>
	  			</table>
	  		</div>
		</div>
<!-- 		<nav class="nav nav-auto affix dock-bottom justified"> -->
<!-- 			<button id="btnClose" type="button" class="btn info outline">返回</button> -->
<!-- 			<button id="btnDoctorZdSave" type="button" class="btn primary">保存</button> -->
<!-- 		</nav> -->
	</div>
	
	<!-- 确认订单(医生) -->
	<div id="pnlDrQr" class="panel" style="display: none;">
		<div class="panel-body">
			<form id="realOderForm" class="box">
				<div class='heading'>
					<div class='title'><strong>基本信息</strong></div>
			  	</div>
				<div class="list section rounded-lg" style="margin-bottom: 0px;">
					<div class="control flex drwd_row" style="padding-top:15px;">
						<label class="addon">麻醉方法</label>
						<select name="anestheticId" id="anestheticId" class="drwd_input" th:field="${doc.anestheticName}">
							<option th:if="${doc.anestheticName eq al.anestheticName}" th:selected="selected"  th:each="al,alStat : ${anestheticls}" th:value="${al.anestheticId}" th:text="${al.anestheticName}"></option>
							<option th:if="${doc.anestheticName ne al.anestheticName}" th:each="al,alStat : ${anestheticls}" th:value="${al.anestheticId}" th:text="${al.anestheticName}"></option>
						</select>
					</div>
					<div class="control flex drwd_row">
						<label class="addon" style="color: red;">身高(cm)</label>
						<input id="height" name="height" type="text" class="input drwd_input" placeholder="身高" th:value="${doc.height}">
					</div>	
					<div class="control flex drwd_row">
						<label class="addon" style="color: red;">体重(kg)</label>
						<input id="weight" name="weight" type="text" class="input drwd_input" placeholder="体重" th:value="${doc.weight}">
					</div>
					<div class="control flex drwd_row">
						<label class="addon">ASA</label>
						<select name="asa" id="asa" class="drwd_input">
							<option value="0">I</option>
							<option value="1">II</option>
							<option value="2">III</option>
							<option value="3">IV</option>
							<option value="4">V</option>
							<option value="5">E</option>
						</select>
					</div>
					<div class="control flex drwd_row">
						<label class="addon">系统病史</label>
						<input id="xtbs" name="xtbs" type="text" class="input drwd_input" placeholder="系统病史" th:value="${doc.xtbs}">
					</div>
					<div class="control flex drwd_row">
						<label class="addon">手术史</label>
						<select name="shs" id="shs" class="drwd_input">
							<option value="0">无</option>
							<option value="1">有</option>
						</select>
					</div>
					<div class="control flex drwd_row">
						<label class="addon">手术次数</label>
						<input id="shcs" name="shcs" type="text" class="input drwd_input" placeholder="手术史次数" disabled="disabled" th:value="${doc.shcs}">
					</div>
					<div class="control flex drwd_row">
						<label class="addon" style="color: red;">开始时间</label>
						<input id="sskssj" name="sskssj" type="text" class="input form-datetime drwd_input" placeholder="麻醉开始时间" th:value="${doc.sskssj}">
					</div>
					<div class="control flex drwd_row">
						<label class="addon" style="color: red;">结束时间</label>
						<input id="ssjssj" name="ssjssj" type="text" class="input form-datetime drwd_input" placeholder="麻醉结束时间" th:value="${doc.ssjssj}">
					</div>
					<div class="control flex drwd_row">
						<label class="addon">时长</label>
						<input id="sssc" name="sssc" type="hidden" class="input drwd_input" placeholder="时长（分）" th:value="${doc.sssc}" disabled="disabled">
						<input id="ssscVal" name="ssscVal" type="text" class="input drwd_input" placeholder="时长" th:value="${doc.ssscVal}" disabled="disabled">
					</div>
					<div class="control flex drwd_row" style="padding-bottom: 15px;">
						<label class="addon">局麻技术</label>
						<select name="jmjs" id="jmjs" class="drwd_input">
							<option value="0">好</option>
							<option value="1">一般</option>
							<option value="2">差</option>
							<option value="3">拒绝实施局麻</option>
						</select>
					</div>
				</div>
				
				<div class='heading'>
					<div class='title'><strong>意外事件 - 呼吸系统</strong></div>
			  	</div>
				<div class="list section rounded-lg" style="margin-bottom: 0px;">
					<!-- 呼吸系统    -->
<!-- 					<div class="control flex drwd_row" style="padding-top:15px;margin-bottom: 0;"> -->
<!-- 						<label class="addon" style="width: -webkit-fill-available;">呼吸系统</label> -->
<!-- 					</div>	 -->
					<div class="control flex drwd_row">
						<div class="checkbox" style="width: -webkit-fill-available;">
					        <input type="checkbox" id="ywsjHxxt_0" name="ywsjHxxt" value="0">
					        <label for="ywsjHxxt">频繁舌后坠（≥3次）</label>
					   	</div>
					</div>
					<div class="control flex drwd_row">
						<div class="checkbox" style="width: -webkit-fill-available;">
					        <input type="checkbox" id="ywsjHxxt_1" name="ywsjHxxt" value="1">
					        <label for="ywsjHxxt">喉痉挛</label>
					   	</div>
					</div>
					<div class="control flex drwd_row">
					   	<div class="checkbox" style="width: -webkit-fill-available;">
					        <input type="checkbox" id="ywsjHxxt_2" name="ywsjHxxt" value="2">
					        <label for="ywsjHxxt">返流</label>
					   	</div>
					</div>
					<div class="control flex drwd_row">
					   	<div class="checkbox" style="width: -webkit-fill-available;">
					        <input type="checkbox" id="ywsjHxxt_3" name="ywsjHxxt" value="3">
					        <label for="ywsjHxxt">误吸</label>
					   	</div>
					</div>
					<div class="control flex drwd_row">
					   	<div class="checkbox" style="width: -webkit-fill-available;">
					        <input type="checkbox" id="ywsjHxxt_4" name="ywsjHxxt" value="4">
					        <label for="ywsjHxxt">支气管痉挛</label>
					   	</div>
					</div>
					<div class="control flex drwd_row">
					   	<div class="checkbox" style="width: -webkit-fill-available;">
					        <input type="checkbox" id="ywsjHxxt_5" name="ywsjHxxt" value="5">
					        <label for="ywsjHxxt">计划外插管</label>
					   	</div>
					</div>
					<div class="control flex drwd_row">
					   	<div class="checkbox" style="width: -webkit-fill-available;">
					        <input type="checkbox" id="ywsjHxxt_6" name="ywsjHxxt" value="6">
					        <label for="ywsjHxxt">其他</label>
					   	</div>
					</div>
					<div class="control flex drwd_row" style="padding-bottom: 10px;">
						<input id="ywsjHxxtQt" name="ywsjHxxtQt" type="text" class="input drwd_input" placeholder="呼吸系统(其它)" disabled="disabled" />
					</div>
				</div>
				
				<div class='heading'>
					<div class='title'><strong>意外事件 - 循环系统</strong></div>
			  	</div>
				<div class="list section rounded-lg" style="margin-bottom: 0px;">	
					<!-- 循环系统    -->
<!-- 					<div class="control flex drwd_row" style="margin-bottom: 0;"> -->
<!-- 						<label class="addon" style="width: -webkit-fill-available;">循环系统</label> -->
<!-- 					</div>	 -->
					<div class="control flex drwd_row">
						<div class="checkbox" style="width: -webkit-fill-available;">
					        <input type="checkbox" id="ywsjXhxt_0" name="ywsjXhxt" value="0">
					        <label for="ywsjXhxt">需纠正的低血压</label>
					   	</div>
					</div>
					<div class="control flex drwd_row"> 
						<div class="checkbox" style="width: -webkit-fill-available;">
					        <input type="checkbox" id="ywsjXhxt_1" name="ywsjXhxt" value="1">
					        <label for="ywsjXhxt">需纠正的高血压</label>
					   	</div>
					</div>
					<div class="control flex drwd_row">
					   	<div class="checkbox" style="width: -webkit-fill-available;">
					        <input type="checkbox" id="ywsjXhxt_2" name="ywsjXhxt" value="2">
					        <label for="ywsjXhxt">肺动脉栓塞</label>
					   	</div>
					</div>
					<div class="control flex drwd_row">
					   	<div class="checkbox" style="width: -webkit-fill-available;">
					        <input type="checkbox" id="ywsjXhxt_3" name="ywsjXhxt" value="3">
					        <label for="ywsjXhxt">心梗</label>
					   	</div>
					</div>
					<div class="control flex drwd_row">
					   	<div class="checkbox" style="width: -webkit-fill-available;">
					        <input type="checkbox" id="ywsjXhxt_4" name="ywsjXhxt" value="4">
					        <label for="ywsjXhxt">脑梗</label>
					   	</div>
					</div>
					<div class="control flex drwd_row">
					   	<div class="checkbox" style="width: -webkit-fill-available;">
					        <input type="checkbox" id="ywsjXhxt_5" name="ywsjXhxt" value="5">
					        <label for="ywsjXhxt">其他</label>
					   	</div>
					</div>
					<div class="control flex drwd_row" style="padding-bottom: 10px;">
					   	<input id="ywsjXhxtQt" name="ywsjXhxtQt" type="text" class="input drwd_input" placeholder="循环系统(其它)" disabled="disabled" />
					</div>
				</div>
				
				<div class='heading'>
					<div class='title'><strong>意外事件 - 过敏原</strong></div>
			  	</div>
				<div class="list section rounded-lg" style="margin-bottom: 0px;">	
					<!-- 过敏原    -->
					<div class="control flex drwd_row" style="padding-top: 10px;">
						<label class="addon">是否过敏</label>
						<select name="ywsjGm" id="ywsjGm" class="drwd_input">
							<option value="-1"></option>
							<option value="1">no</option>
							<option value="2">yes</option>
						</select>
					</div>
					<div class="control flex drwd_row">
						<label class="addon">过敏原</label>
						<input id="ywsjGmSocre" name="ywsjGmSocre" type="text" class="input drwd_input" placeholder="过敏原详情" disabled="disabled" />
					</div>
					<div class="control flex drwd_row" style="padding-bottom: 15px;">
						<label class="addon">其它</label>
						<input id="ywsjQt" name="ywsjQt" type="text" class="input drwd_input" placeholder="其它" th:value="${doc.ywsjQt}" />
					</div>
				</div>
				
				<!-- 术后不良    -->
				<div class='heading'>
					<div class='title'><strong>术后不良</strong></div>
			  	</div>
				<div class="list section rounded-lg" style="margin-bottom: 0px;">
					<div class="control flex drwd_row">
						<div class="checkbox" style="width: -webkit-fill-available;">
							<input id="shblZw" type="checkbox" name="shblZw">
							<label for="shblZw"> 谵妄</label>
						</div>
					</div>
					<div class="control flex drwd_row">
						<div class="checkbox" style="width: -webkit-fill-available;">
							<input id="shblHbtt" type="checkbox" name="shblHbtt">
							<label for="shblHbtt"> 喉部疼痛</label>
						</div>
					</div>
					<div class="control flex drwd_row">
						<div class="checkbox" style="width: -webkit-fill-available;">
							<input id="shblEx" type="checkbox" name="shblEx">
							<label for="shblEx"> 恶心</label>
						</div>
					</div>
					<div class="control flex drwd_row">
						<div class="checkbox" style="width: -webkit-fill-available;">
							<input id="shblXy" type="checkbox" name="shblXy">
							<label for="shblXy"> 眩晕</label>
						</div>
					</div>
					<div class="control flex drwd_row">
						<div class="checkbox" style="width: -webkit-fill-available;">
							<input id="shblOt" type="checkbox" name="shblOt">
							<label for="shblOt"> 呕吐</label>
						</div>
					</div>
					<div class="control flex drwd_row" style="padding-bottom: 10px;">
						<label class="addon" style="color: red;">疼痛治疗</label>
						<select name="shttzl" id="shttzl" class="drwd_input">
							<option value="-1"></option>
							<option value="1">口服药</option>
							<option value="2">静脉推注</option>
							<option value="3">静脉镇痛泵</option>
							<option value="4">椎管内镇痛泵</option>
							<option value="5">无镇痛</option>
						</select>
					</div>
					
				</div>
				
				<!-- 备注    -->
				<div class='heading'>
					<div class='title'><strong>备注</strong></div>
			  	</div>
				<div class="list section rounded-lg" style="margin-bottom: 0px;padding-top: 10px;">
<!-- 					<div class="control flex drwd_row" style="margin-bottom: 10;"> -->
<!-- 						<label class="addon" style="width: -webkit-fill-available;">医生备注</label> -->
<!-- 					</div> -->
					<div class="control flex drwd_row" style="padding-bottom: 10px;">
						<textarea class="textarea" name="doctorMemo" id="doctorMemo" rows="5" placeholder="麻醉医生备注"  style="width: -webkit-fill-available;"></textarea>
					</div>
				</div>
				
				<!-- 图片    -->
				<div class='heading'>
					<div class='title'><strong>照片</strong></div>
			  	</div>
				<div class="list section rounded-lg" style="margin-bottom: 0px;">
					<input id="doc_photo" type="hidden" name="photo" class="input" th:value="${doc?.photo}">
					<button id="btnUpload" type="button" class="btn btn-info"  style="width: -moz-available;width: -webkit-fill-available;height:30px;background-color:#FFFFFF;border:1px solid #CECECE">
						<i class="icon icon-plus"></i> 选择文件
					</button>
									
					<div class="layui-upload-list" id="photo_list" style="height: 200px;width:-webkit-fill-available;"></div>				
				</div>	
			</form>
			<div>
				<button id="btnClose" type="button" style="padding:0 0;margin:0 0;width:49%;float:left;" class="btn info outline">返回</button>
				<button id="btnDrSave" type="button" style="padding:0 0;margin:0 0;width:49%;float:left;" class="btn primary">保存</button>
			</div>
		</div>
	</div>

	<!-- 团队分配 -->
	<div id="pnlTeamFp" class="panel" style="display: none;">
		<div class="panel-body" style="margin-top: -10px;">
			<input id="TeamCount" type="hidden" value="0"></input>
			<div class="heading" >
				<div class="title" style="text-align: center;"><strong>副麻</strong></div>
	  		</div>
	    	<div id="fm_main" class="row" style="width:100%;">
				
	    	</div>
    	
	    	<div id="fm_add" class="row" style="margin-top: 8px;text-align: center;padding: 0 10px 0 10px;">
				<button class="btn inverse outline addBox" onclick="btnFmUserAdd()" style="margin: 10 auto;">
					<i class="icon icon-plus" style="font-size: 50px;color: #aaa;"></i>
				</button>
	    	</div>
	    	<div class="heading" >
				<div class="title" style="text-align: center;"><strong>护士</strong></div>
	  		</div>
	  		<div id="hs_main" class="row" style="width:100%;">
				
	    	</div>
	    	<div id="hs_add" class="row" style="margin-top: 8px;text-align: center;padding: 0 10px 0 10px;">
	    		<button class="btn inverse outline addBox" onclick="btnHsUserAdd()" style="margin: 10 auto;">
					<i class="icon icon-plus" style="font-size: 50px;color: #aaa;"></i>
				</button>
	    	</div>
		</div>
	</div>
	<div id="pnlTeamUserList" class="panel" style="display: none;">
		<div class="panel-body">
			<div class="control flex">
	      		<label for="fp_searchVal" style="width:100px;padding:5 5 5 10;vertical-align: top;font-weight: 700;text-align: right;">姓名：</label>
	      		<input class="text" name="team_searchVal" id="team_searchVal" value=""/>
	      		<button name="btnSearch" type="button" class="btn btn-small primary hover-solid" style="padding:0;height: 26px;margin-left: 5px;"><i class="icon icon-search"></i></button>
	   		</div>
	   		
	   		<div class="row" style="padding: 0 10px 0 10px;">
				<table id="team_table" class="table compact striped" style="font-size: .7rem;text-align: center;">
					<thead>
				    	<tr>
				      		<th style="text-align: center;">姓名</th>
				      		<th style="text-align: center;">年龄</th>
				      		<th style="text-align: center;">性别</th>
				      		<th style="text-align: center;">操作</th>
			    		</tr>
					</thead>
					<tbody></tbody>
	  			</table>
	  		</div>
   		</div>
	</div>
	
	<!-- 取消订单 -->
	<div id="pnlCannel" class="panel" style="display: none;">
		<div class="panel-body">
			<div class="row" style="padding: 0 20px 0 20px;">
				<table class="patient_table" style="width: 100%;">
					<tr>
      					<th class="title">取消原因：</th>
    				</tr>
    				<tr>
    					<td>
    						<div class="radio">
        						<input type="radio" name="qxRadio" value="1" style="box-sizing:inherit;">
        						<label for="qxRadio">患者原因</label>
      						</div>
      						<div class="radio myradio">
        						<input type="radio" name="qxRadio" value="2">
        						<label for="qxRadio">机构原因</label>
      						</div>
      						<div class="radio myradio">
        						<input type="radio" name="qxRadio" value="3">
        						<label for="qxRadio">医生原因</label>
      						</div>
      						<div class="radio myradio">
        						<input type="radio" name="qxRadio" value="4">
        						<label for="qxRadio">订单错误</label>
      						</div>
      						<div class="radio myradio">
        						<input type="radio" name="qxRadio" value="5">
        						<label for="qxRadio">其他（原因）</label>
      						</div>
    					</td>
    				</tr>
    				<tr>
    					<td>
    						<textarea class="textarea" name="reason" id="reason" rows="5"></textarea>
    					</td>
    				</tr>
    			</table>
    		</div>
   		</div>
		<nav class="nav nav-auto affix dock-bottom justified">
			<button id="btnQxSave" type="button" class="btn primary">保存</button>
		</nav>
	</div>
	
	<!-- 退回待完成订单 -->
	<div id="pnlRetWait" class="panel" style="display: none;">
		<div class="panel-body"  style="padding: 0 20px 0 20px;">
     		<span class="title" style="font-weight: bold;">取消原因：</span>
   			<textarea class="textarea" name="adminMemo" id="adminMemo" rows="5" placeholder="管理员备注"  style="width: -webkit-fill-available;margin-top: 5px;"></textarea>
   			
   		</div>	
		<nav class="nav nav-auto affix dock-bottom justified">
			<button id="btnRetWaitClose" type="button" class="btn info outline">返回</button>
			<button id="btnRetWaitSave" type="button" class="btn primary">确认</button>
		</nav>
	</div>
	<!-- 评价 -->
	<div id="pnlDocDrDf" class="panel" style="display: none;">
		<div class="panel-body" style="margin-top: -10px;">
			<fieldset class="layui-elem-field layui-field-title" style="margin: 30px 30px 0 30px;">
				<legend style="font-size: 14px;margin: 0 auto;">匿名评价机构</legend>
			</fieldset>
			<div class="layui-row" style="margin: 0 20px 0 20px;">
				<div class="layui-row" style="margin-top: 8px;text-align: center;">
					<div class="layui-input-block" style="margin-left: 0px;">
						<div id="dr_star"></div>
						<input type="hidden" id="df_de">
					</div>
				</div>
				
				<div class="layui-row" style="margin-top: 10px;">
		     		<div class="layui-input-block" style="margin-left: 0px;">
		          		<textarea placeholder="如果有其他意见和建议，请放心填写" class="layui-textarea" id="df_dem" style="width: -moz-available;"></textarea>
		       		</div>
		     	</div>
			</div>
			
<!-- 			<div class="row"> -->
<!-- 	  			<div class="cell-3" style="font-size: .7rem;font-weight: 700;padding-top: 8px;">医生评分:</div> -->
<!-- 				<div class="cell-9"> -->
<!-- 					<input type="hidden" id="df_de" value="-1"> -->
<!-- 					<ul class="star_ul fl" style="margin:0;"> -->
<!-- 						<li><a id="df-dr-star-1" class="one-star" title="很差" onclick="changeStar(1)"></a></li> -->
<!-- 						<li><a id="df-dr-star-2" class="two-star" title="差" onclick="changeStar(2)"></a></li> -->
<!-- 						<li><a id="df-dr-star-3" class="three-star" title="还行" onclick="changeStar(3)"></a></li> -->
<!-- 						<li><a id="df-dr-star-4" class="four-star" title="好" onclick="changeStar(4)"></a></li> -->
<!-- 						<li><a id="df-dr-star-5" class="five-star" title="很好" onclick="changeStar(5)"></a></li> -->
<!-- 					</ul> -->
<!-- 				</div> -->
<!-- 	  		</div> -->
<!-- 	  		<div class="row" style="padding: 0 20px 0 20px;"> -->
<!-- 				<div class="cell-3" style="font-size: .7rem;font-weight: 700;">医生评价:</div> -->
<!-- 				<div class="cell-9"> -->
<!-- 					<textarea class="textarea" id="df_dem" rows="3"></textarea> -->
<!-- 				</div> -->
<!-- 			</div> -->
			<nav class="nav nav-auto affix dock-bottom justified">
				<button id="btnClose" type="button" class="btn info outline">返回</button>
				<button id="btnDrDf" type="button" class="btn primary">保存</button>
			</nav>
		</div>
	</div>
<!-- <script th:src="@{/js/datePlugin/jquery-1.10.0.min.js}"></script> -->
<script th:src="@{/js/jquery.min.js}"></script>
<script th:src="@{/js/jweixin-1.6.0.js}"></script>
<script th:src="@{/js/wxImage.js}"></script>
<script th:src="@{/js/layer.js}"></script>
<script th:src="@{/js/mzui.min.js}"></script>
<script th:src="@{/lib/layui/layui.js}"></script>

<script th:src="@{/js/jquery.serializejson.min.js}"></script>
<script th:src="@{/js/datePlugin/mobiscroll_002.js}"></script>
<script th:src="@{/js/datePlugin/mobiscroll_004.js}"></script>
<script th:src="@{/js/datePlugin/mobiscroll.js}"></script>
<script th:src="@{/js/datePlugin/mobiscroll_003.js}"></script>
<script th:src="@{/js/datePlugin/mobiscroll_005.js}"></script>
<script th:src="@{/js/viewer.min.js}"></script>

<!-- <script th:src="@{js/bootstrap-datetimepicker.min.js}"></script>
<script th:src="@{js/bootstrap-datetimepicker.zh-CN.js}"></script> -->
<script  th:inline="javascript">
	//console.log(location.href.split('#')[0])
	var doc = [[${doc}]];
	var u = [[${user}]];
	var state = [[${state}]];
	
	var appId = [[${aid}]];//公众号的唯一标识
	var timestamp = [[${ts}]];//生成签名的时间戳
	var nonceStr = [[${ns}]];//生成签名的随机串
	var signature = [[${sg}]];//签名 
	
	wx.config({
	   debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
	   beta: true,  // 对于没有公开的接口
	   appId: appId, // 必填，公众号的唯一标识
	   timestamp: timestamp, // 必填，生成签名的时间戳
	   nonceStr: nonceStr, // 必填，生成签名的随机串
	   signature: signature,// 必填，签名，见附录1
	   jsApiList: ['chooseImage',
	               'previewImage',
	               'uploadImage',
	               'downloadImage'] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
	});
	
	var docId = $("#docId").val();
	
	function onHtmlBack(){
		location.href = "/toDocList?ds=" + state;
	}
	
	$(document).ready(function(){ 
		//评价
		var de = $("#doctorEvaluate").val();
		if(de > 0 && de <= 1)
			$("#dr-star-1").addClass("active-star");
		else if(de > 1 && de <= 2)
			$("#dr-star-2").addClass("active-star");
		else if(de > 2 && de <= 3)
			$("#dr-star-3").addClass("active-star");
		else if(de > 3 && de <= 4)
			$("#dr-star-4").addClass("active-star");
		else if(de > 4 && de <= 5)
			$("#dr-star-5").addClass("active-star");
		
		var he = $("#hospitalEvaluate").val();
		if(he > 0 && he <= 1)
			$("#jg-star-1").addClass("active-star");
		else if(he > 1 && he <= 2)
			$("#jg-star-2").addClass("active-star");
		else if(he > 2 && he <= 3)
			$("#jg-star-3").addClass("active-star");
		else if(he > 3 && he <= 4)
			$("#jg-star-4").addClass("active-star");
		else if(he > 4 && he <= 5)
			$("#jg-star-5").addClass("active-star");
	}); 
	
	//动态变更界面
	function ajaxChangeHtml(state){
		if(state == "0-1"){
			$("#tag_state").html("<div class='pull-right label red-pale text-tint'>待分配</div>");
			$("#nav_btn").html("<button type='button' class='btn danger outline' style='border-radius:.3rem 0 0 .3rem;'>取消订单</button>" +
							  "<button type='button' class='btn primary' style='border-radius:0 .3rem .3rem 0;' onclick='btnFpClick()'>订单分配</button>");
		}else if(state == "1-2"){
			$("#tag_state").html("<div class='pull-right label red-pale text-tint'>已分配</div>");
			$("#nav_btn").html("<button type='button' class='btn danger outline' style='border-radius:.3rem 0 0 .3rem;'>取消订单</button>" +
							  "<button type='button' class='btn danger' style='border-radius: .3rem;' onclick='btnQxFpClick()'>取消分配</button>");
		}else if(state == "2-1"){
			$("#tag_state").html("<div class='pull-right label red-pale text-tint'>待分配</div>");
			$("#nav_btn").html("<button type='button' class='btn danger outline' style='border-radius:.3rem 0 0 .3rem;'>取消订单</button>" +
							  "<button type='button' class='btn primary' style='border-radius:0 .3rem .3rem 0;' onclick='btnFpClick()'>订单分配</button>");
		}else if(state == "2-3"){
			$("#tag_state").html("<div class='pull-right label red-pale text-tint'>待手术</div>");
/////////////////？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？
			$("#nav_btn").html("");
		}else if(state == "3-2"){
			$("#tag_state").html("<div class='pull-right label red-pale text-tint'>待接单</div>");
			$("#nav_btn").html("<button type='button' class='btn danger' style='border-radius: .3rem;' onclick='btnDrQxFpClick()'>取消订单</button>" +
							   "<button type='button' class='btn primary' style='border-radius: .3rem;' onclick='btnDrJdClick()'>确认接单</button>");
		}
	}
	
	if(doc.photo != null && doc.photo != ''){
     	var photols = doc.photo.split(",");
     	for(var i = 0; i < photols.length; i++){
     		if(photols[i] != ''){
         		var html = '<div id="photo_' + photoIdx + '" name="'+ photols[i] +'" class="file-iteme" style="width: 149px; height: 180px; float: left;"">';
         		if(doc.status == '0')
         			html += '<div style="float: left;position: absolute;" id="delPhotoBtn' + photoIdx + '" onclick="deletePhoto(' + photoIdx + ')"><i class="icon-2x icon-times"></i></div>';
    			html += '<img style="width: 150px;height: 180px;" src="/getPhotoByFileName?id=' + doc.documentId + '&FileName='+ photols[i] +'" onclick="previewImg(this)">';
    			html += '</div>';
         			
    			$('#main_photo_list').append(html);
     		}
     	}
	}
	
	//【按钮】确认订单
	$("#btnSh").on("click", function(){
		if(docId != ''){
			$("#nav_btn").toggleClass("loading loading-light");
			
			var dataJson = "{'type':'s', 'id':'" + doc.documentId + "', 'ds':'1', 'ods':'0'}";
		
 			$.ajax({
				type: "POST",
		 		url: "/updateDocInfo",
		  		data: "jsondata=" + dataJson,
				dataType: "json",
				success: function(data){
					if(data.code == 1){
						$("#nav_btn").toggleClass("loading loading-light");
						
// 						ajaxChangeHtml("0-1");
						location.reload();

					}else{
						alert("网络失败,请重试!");
					}
		       	},
		     	error: function () {
		     		alert("网络异常,请重试!");
			 	}
			});
		}
	});
	//------------------------------------------------    分配开始            --------------------------------------------------------------//
	//【按钮】订单分配
	function btnFpClick(){
		layer.open({
			type: 1,
			title: ['<span style=\"float: left;\">订单分配</span><button id=\"btnLayClose\" type=\"button\" class=\"btn btn-sm\" style=\"float: right;padding: 7 0;\"><i class=\"icon icon-times\"></i></button>', 'background-image:linear-gradient(-12deg,#8470FF 0,#6495ED 100%) !important; color:white;'],
			content: $("#pnlFp").html(),
			anim: 'scale',
			scrollbar: false,
			style: 'position:fixed; left:0; top:0;-webkit-overflow-scrolling: touch;overflow-y: scroll; width:100%; height:100%; border: none; -webkit-animation-duration: .5s; animation-duration: .5s;',
			success: function(elem){
				//全局参数
				var body = $("#" + elem.id);
				var obj = body.find("#fp_table tbody");
				
				//按钮事件
				body.on("click", "[name='btnSearch']", function() {
					var searchVal = body.find("#fp_searchVal").val();
					searchFp(obj, searchVal);
				});
				
				body.on("click", "[name='fpbtn']", function() {
					var btn_id = this.id;
					var uinfo = btn_id.split("_");
					var uid = uinfo[1];
					var uname = uinfo[2];
					
					layer.open({
					    content: "确认分配给医生：" + uname,
					   	btn: ['确认','取消'],
					    yes: function(index){
					    	setFp(body, uid);
					    	layer.close(index);
					    }
					});
				});
				
				body.on('click', '#btnLayClose', function() {
					layer.closeAll();
				});
				
				//init
		 		searchFp(obj, "");
			}
		});
				
	};
	
	function searchFp(obj, searchVal){
		$.ajax({
			type: "POST",
	 		url: "/getDistributionDrGridList",
	 		data: "id=" + doc.documentId + "&searchVal=" + searchVal,
			dataType: "json",
			success: function(data){
				var list = data.list;
				if(list != null){
					var result = "";
					
					for(var i = 0; i < list.length; i++){
						var u = list[i];
						result += "<tr>";
						
// 						if(u.distributionScore > 4 && u.distributionScore < 8){
// 							result +="<td class='font_color_blue'>推荐</td>";
// 						}else if(u.distributionScore > 8){
// 							result +="<td class='font_color_green'>强推</td>";
// 						}else{
// 							result +="<td class='font_color_red'></td>";
// 						}
						
				        result +="<td>" + u.userName + "</td>";
				        if(u.isrecord == '1'){
				        	result +="<td style='color:blue'>✔</td>";
				        }else{
				     		result +="<td style='color:red'>✖</td>";
				        }
				        
						if(u.fAvgEvaluate > 0){	
				        	result +="<td>" + u.fAvgEvaluate + "</td>";
						}else{
							result +="<td>-</td>";
						}
				        
				        result +="<td><button name='fpbtn' id='fpbtn_" + u.userId + "_" + u.userName + "' type='button' class='btn btn-sm'><i class='icon icon-cog'></i></button></td>";
				        result +="</tr>";
					}
					
					obj.html(result);
	         	}else{
	            	obj.html("");
		      	}
	       	},
	     	error: function () {
		   		alert("网络异常,请重试!");
		 	}
		});
	}
	
	function setFp(body, uid){
		body.find("#pnlFp").toggleClass("loading loading-light");
		
		var dataJson = "{'type':'s', 'id':'" + doc.documentId + "', 'qid':'" + uid + "', 'ds':'2', 'ods':'1'}";
    	
		$.ajax({
			type: "POST",
	 		url: "/updateDocInfo",
	  		data: "jsondata=" + dataJson,
			dataType: "json",
			success: function(data){
				if(data.code == 1){
					body.find("#pnlFp").toggleClass("loading loading-light");
					layer.closeAll();
					
// 					ajaxChangeHtml("1-2");
					location.reload();
				}else{
					alert("网络失败,请重试!");
				}
	       	},
	     	error: function () {
	     		alert("网络异常,请重试!");
		 	}
		});
	}
	
	function btnQxFpClick(){
		layer.open({
		    content: "确认取消分配！",
		   	btn: ['确认','取消'],
		    yes: function(index){
		    	setQxFp();
		    	layer.close(index);
		    }
		});
	};
	function setQxFp(){
		var dataJson = "{'type':'s', 'id':'" + doc.documentId + "', 'ds':'1', 'ods':'2'}";
		
		$("#nav_btn").toggleClass("loading loading-light");
		
		$.ajax({
			type: "POST",
	 		url: "/updateDocInfo",
	  		data: "jsondata=" + dataJson,
			dataType: "json",
			success: function(data){
				if(data.code == 1){
					$("#nav_btn").toggleClass("loading loading-light");
// 					ajaxChangeHtml("2-1");
					location.reload();
				}else{
					alert("网络失败,请重试!");
				}
	       	},
	     	error: function () {
	     		alert("网络异常,请重试!");
		 	}
		});
	}
	//------------------------------------------------    分配结束            --------------------------------------------------------------//
	
	//------------------------------------------------    接单开始            --------------------------------------------------------------//
	//【按钮】拒绝订单
	function btnDrQxFpClick(){
		layer.open({
			content: '如需取消分配，请联系管理员!<br/>(电话:400-123-456)'
		    ,btn: '关闭'
		});
	}
	
	//【按钮】确认接单
	function btnDrJdClick(){
		layer.open({
		    content: "确认接单！",
		   	btn: ['确认','取消'],
		    yes: function(index){
		    	setDrJd();
		    	layer.close(index);
		    }
		});
	}
	
	function setDrJd(){
		var dataJson = "{'type':'s', 'id':'" + doc.documentId + "', 'ds':'3', 'ods':'2'}";
		
		$("#nav_btn").toggleClass("loading loading-light");
		
		$.ajax({
			type: "POST",
	 		url: "/updateDocInfo",
	  		data: "jsondata=" + dataJson,
			dataType: "json",
			success: function(data){
				if(data.code == 1){
					$("#nav_btn").toggleClass("loading loading-light");
// 					ajaxChangeHtml("2-3");
					location.reload();
				}else{
					alert("网络失败,请重试!");
				}
	       	},
	     	error: function () {
	     		alert("网络异常,请重试!");
		 	}
		});
	}
	
	function btnDrZdClick(){
		var dataJson = "{'documentId':'"+doc.documentId+"', 'operateStartTime' : '"+doc.operateStartTime+"'}";
		
		layer.open({
		  	type: 1,
		  	title: ['<span style=\"float: left;\">转单</span><button id=\"btnLayClose\" type=\"button\" class=\"btn btn-sm\" style=\"float: right;padding: 7 0;\"><i class=\"icon icon-times\"></i></button>', 'background-image:linear-gradient(-12deg,#8470FF 0,#6495ED 100%) !important; color:white;'],
		  	content: $("#pnlZd").html(),
		  	anim: 'scale',
		  	style: 'position:fixed; left:0; top:0;-webkit-overflow-scrolling: touch;overflow-y: scroll; width:100%; height:100%; border: none; -webkit-animation-duration: .5s; animation-duration: .5s;',
			success: function(elem){
				//全局参数
				var body = $("#" + elem.id);
				var obj = body.find("#zd_table tbody");
				
				//按钮事件
				body.on("click", "[name='btnSearch']", function() {
					var searchVal = body.find("#zd_searchVal").val();
					searchZdDr(obj, searchVal);
				});
				
				body.on("click", "[name='zdbtn']", function() {
					var btn_id = this.id;
					var uinfo = btn_id.split("_");
					var uid = uinfo[1];
					var uname = uinfo[2];
					
					layer.open({
					    content: "确认转单给医生：" + uname,
					   	btn: ['确认','取消'],
					    yes: function(index){
					    	setZd(body, uid);
					    	layer.close(index);
					    }
					});
				});
				
				body.on('click', '#btnLayClose', function() {
					layer.closeAll();
				});
				
				//init
		 		searchZdDr(obj, "");
			}
		});
	}
	
	function searchZdDr(obj, searchVal){
		$.ajax({
			type: "POST",
	 		url: "/transferuser",
	 		data: "id=" + doc.documentId + "&searchVal=" + searchVal,
			dataType: "json",
			success: function(data){
				var list = data.list;
				if(list != null){
					var result = "";
					
					for(var i = 0; i < list.length; i++){
						var u = list[i];
						result += "<tr>";
						result +="<td>" + u.userName + "</td>";
						result +="<td>" + u.age + "</td>";
						if(u.sex == '1')
				        	result +="<td>男</td>";
				  		else
				  			result +="<td>女</td>";
				        result +="<td><button name='zdbtn' id='zdbtn_" + u.userId + "_" + u.userName + "' type='button' class='btn btn-sm'><i class='icon icon-cog'></i></button></td>";
				        result +="</tr>";
					}
					
					obj.html(result);
	             }else{
	            	 obj.html("");
	             }
	       	},
	     	error: function () {
		   		alert("网络异常,请重试!");
		 	}
		});
	}
	
	function setZd(body, uid){
		body.find("#pnlZd").toggleClass("loading loading-light");
		
		var dataJson = "{'type':'zd', 'id':'" + doc.documentId + "', 'qid':'" + uid + "', 'ds':'3', 'ods':'3'}";
    	
		$.ajax({
			type: "POST",
	 		url: "/updateDocInfo",
	  		data: "jsondata=" + dataJson,
			dataType: "json",
			success: function(data){
				if(data.code == 1){
					body.find("#pnlZd").toggleClass("loading loading-light");
					
					location.href="/toDocList?ds=" + state;
				}else{
					alert("网络失败,请重试!");
				}
	       	},
	     	error: function () {
	     		alert("网络异常,请重试!");
		 	}
		});
	}
	
	//撤销订单
	function recallDoc(){
		layer.open({
		    content: "确认撤销接单！",
		   	btn: ['确认','取消'],
		    yes: function(index){
		    	setRecallDoc();
		    	layer.close(index);
		    }
		});
	}
	function setRecallDoc(){
		var dataJson = "";
		
		if(doc.transferUserId != null && doc.transferUserId != ""){
			dataJson = "{'type':'s', 'id':'" + doc.documentId + "', 'qid':'" + doc.transferUserId + "', 'ds':'3', 'ods':'3'}";
		}else{
			dataJson = "{'type':'s', 'id':'" + doc.documentId + "', 'ds':'2', 'ods':'3'}";
		}
		
		$("#nav_btn").toggleClass("loading loading-light");
		
		$.ajax({
			type: "POST",
	 		url: "/updateDocInfo",
	  		data: "jsondata=" + dataJson,
			dataType: "json",
			success: function(data){
				if(data.code == 1){
					$("#nav_btn").toggleClass("loading loading-light");
					
					if(doc.transferUserId != null && doc.transferUserId != ""){
						location.href="/toDocList?ds=" + state;
					}else{
// 						ajaxChangeHtml("3-2");
						location.reload();
					}
				}else{
					alert("网络失败,请重试!");
				}
	       	},
	     	error: function () {
	     		alert("网络异常,请重试!");
		 	}
		});
	}
	
	//------------------------------------------------    接单结束           --------------------------------------------------------------//
	
	//------------------------------------------------    麻醉开始         --------------------------------------------------------------//
	var tmpBody;
	function btnDrQrInfo(){
		layer.open({
			type: 1,
			title: ['<span style=\"float: left;\">手术信息</span><button id=\"btnLayClose\" type=\"button\" class=\"btn btn-sm\" style=\"float: right;padding: 7 0;\"><i class=\"icon icon-times\"></i></button>', 'background-image:linear-gradient(-12deg,#8470FF 0,#6495ED 100%) !important; color:white;'],
		  	content: $("#pnlDrQr").html(),
		  	anim: 'scale',
		  	style: 'position:fixed; left:0; top:0;-webkit-overflow-scrolling: touch;overflow-y: scroll; width:100%; height:100%; border: none; -webkit-animation-duration: .5s; animation-duration: .5s;',
		  		success: function(elem){
					//全局参数
					var body = $("#" + elem.id);
					var objForm = body.find("#realOderForm");
					tmpBody = body;
					//按钮事件
					body.on('click', '#btnClose', function() {
						layer.closeAll();
					});
					
					body.on('click', '#btnDrSave', function() {
						layer.open({
							content: "保存",
						   	btn: ['提交订单','保存草稿'],
						    yes: function(index){
						    	commitDoc(objForm, true, index);
						    	layer.close(index);
						    },
						    no: function(index){
						    	commitDoc(objForm, false, index);
						    	layer.close(index);
						    }
						});
					});

					body.on('click', '#btnLayClose', function() {
						layer.closeAll();
					});
					
					//上传
					body.on('click', '#btnUpload', function() {
						imgUpload(body);
					});
					
					//init
			 		setDrQrInfo(objForm);
				}
		});
		
	}
	
	function setDrQrInfo(obj){
		//时间控件初始化
		var currYear = (new Date()).getFullYear();	
		var opt={};
		opt.date = {preset : 'date'};
		opt.datetime = {preset : 'datetime'};
		opt.time = {preset : 'time'};
		opt.default = {
			theme: 'android-ics light', //皮肤样式
	        display: 'modal', //显示方式 
	        mode: 'scroller', //日期选择模式
			dateFormat: 'yyyy-mm-dd',
			lang: 'zh',
			showNow: true,
			nowText: "今天",
	        startYear: currYear - 5, //开始年份
	        endYear: currYear + 5, //结束年份
	        onSelect: function (valueText, inst) {//选择时事件（点击确定后），valueText 为选择的时间，
                var selectedDate = valueText;
	        	changeDate(obj);
            }
		};
		var optDateTime = $.extend(opt['datetime'], opt['default']);
		//麻醉开始时间
		obj.find("#sskssj").css({"background-color":'white'});
        obj.find("#sskssj").mobiscroll(optDateTime).datetime(optDateTime);
        //麻醉结束时间
        obj.find("#ssjssj").css({"background-color":'white'});
        obj.find("#ssjssj").mobiscroll(optDateTime).datetime(optDateTime);
        
        //初始化参数
		//asa
		obj.find("#asa").val(doc.asa);
		//shs
		obj.find("#shs").val(doc.shs);
		//shcs
		if(doc.shs == '1'){
			obj.find("#shcs").removeAttr("disabled");
			obj.find("#shcs").val(doc.shcs);
		}
		//呼吸系统
		var hxxt = doc.ywsjHxxt;
		if(hxxt != undefined && hxxt != ""){
			var hxxts = hxxt.split(",");
			for(var i = 0;i < hxxts.length;i++){
				obj.find("#ywsjHxxt_" + hxxts[i]).prop("checked", true);
				if(hxxts[i] == '6'){
					obj.find("#ywsjHxxtQt").removeAttr("disabled");
					obj.find("#ywsjHxxtQt").val(doc.ywsjHxxtQt);
				}
			}
		}
		//循环系统
		var xhxt = doc.ywsjXhxt;
		if(xhxt != undefined && xhxt != ""){
			var xhxts = xhxt.split(",");
			for(var i = 0;i < xhxts.length;i++){
				obj.find("#ywsjXhxt_" + xhxts[i]).prop("checked", true);
				if(xhxts[i] == '5'){
					obj.find("#ywsjXhxtQt").removeAttr("disabled");
					obj.find("#ywsjXhxtQt").val(doc.ywsjXhxtQt);
				}
			}
		}
		//是否过敏
		var ywsjGm = doc.ywsjGm;
		obj.find("#ywsjGm").val(ywsjGm);
		if(ywsjGm == '2'){
			obj.find("#ywsjGmSocre").removeAttr("disabled");
			obj.find("#ywsjGmSocre").val(doc.ywsjGm);
		}
		//术后不良
		if(doc.shblZw != undefined && doc.shblZw == "1"){
			obj.find("#shblZw").prop("checked", true);
		}
		if(doc.shblHbtt != undefined && doc.shblHbtt == "1"){
			obj.find("#shblHbtt").prop("checked", true);
		}
		if(doc.shblEx != undefined && doc.shblEx == "1"){
			obj.find("#shblEx").prop("checked", true);
		}
		if(doc.shblXy != undefined && doc.shblXy == "1"){
			obj.find("#shblXy").prop("checked", true);
		}
		if(doc.shblOt != undefined && doc.shblOt == "1"){
			obj.find("#shblOt").prop("checked", true);
		}
		//疼痛治疗
		obj.find("#shttzl").val(doc.shttzl);
		obj.find("#doctorMemo").val(doc.qaMemo);
		
        //照片
        var photoIdx = 0;
        var photoCount = 0;
		if(doc.photo != null && doc.photo != ''){
	     	var photols = doc.photo.split(",");
	     	for(var i = 0; i < photols.length; i++){
	     		if(photols[i] != ''){
	         		var html = '<div id="photo_' + photoIdx + '" name="'+ photols[i] +'" class="file-iteme" style="width: 149px; height: 180px; float: left;"">';
	         		if(doc.status == '0')
	         			html += '<div style="float: left;position: absolute;" id="delPhotoBtn' + photoIdx + '" onclick="deletePhoto(' + photoIdx + ')"><i class="icon-2x icon-times"></i></div>';
        			html += '<img style="width: 150px;height: 180px;" src="/getPhotoByFileName?id=' + doc.documentId + '&FileName='+ photols[i] +'" onclick="previewImg(this)">';
        			html += '</div>';
	         			
        			obj.find('#photo_list').append(html);
	         		photoCount++;
	 				photoIdx++;
	 				if(photoCount > 1){
	 					obj.find("#btnUpload").css("display", "none");
	 				}
	     		}
	     	}
	     	
	     	$("#photoCount").val(photoCount);
		}
	}
	
	function changeDate(obj){
		var doc_sskssj_val = obj.find("#sskssj").val();
     	var doc_ssjssj_val = obj.find("#ssjssj").val();
     
//      	alert(doc_sskssj_val + "   " + doc_ssjssj_val);
     
		if(doc_sskssj_val != '' && doc_ssjssj_val != ''){
			if(doc_ssjssj_val < doc_sskssj_val){
				alert("手术【结束时间】应在【开始时间】之后");
				return;
			}else{
				var sskssj = new Date(doc_sskssj_val);
 				var ssjssj = new Date(doc_ssjssj_val);
 			
 				var min = Math.round(Math.abs(ssjssj.getTime() - sskssj.getTime())/1000/60);
 				obj.find("#sssc").val(min);
 				
 				let m = min%60;
    			if(m < 10) m = "0" + m;
    			obj.find("#ssscVal").val(Math.floor(min/60) + ":" + m);
			}
		}
	}
	
	//flag: true 完成订单	false 保存草稿
	function commitDoc(objForm, flag, index){
		var data = objForm.serializeJSON();
// 		console.info(data);

		//数据监测
		if(data.height == undefined || data.height == ""){
			alert("身高不能为空！");
			return;
		}
		if(data.weight == undefined || data.weight == ""){
			alert("体重不能为空！");
			return;
		}
		if(data.sskssj == undefined || data.sskssj == ""){
			alert("麻醉开始时间不能为空！");
			return;
		}
		if(data.ssjssj == undefined || data.ssjssj == ""){
			alert("麻醉结束时间不能为空！");
			return;
		}
		if(data.shttzl == undefined || data.shttzl == ""){
			alert("疼痛治疗不能为空！");
			return;
		}
		
		//麻醉方法
		data["anestheticId"] = objForm.find("#anestheticId").val();
		
		//时长
		data["sssc"] = objForm.find("#sssc").val();
		
		//呼吸系统
		var ywsjHxxt = "";
		objForm.find("input[name='ywsjHxxt']").each(function(){    
			if(objForm.find(this).is(":checked"))    
			{    
				ywsjHxxt += objForm.find(this).val() + ",";    
			}
		});
		data["ywsjHxxt"] = ywsjHxxt.substring(0, ywsjHxxt.length - 1);
		
		//循环系统
		var ywsjXhxt = "";
		objForm.find("input[name='ywsjXhxt']").each(function(){    
			if(objForm.find(this).is(":checked"))
			{    
				ywsjXhxt += objForm.find(this).val() + ",";    
			}
		});
		data["ywsjXhxt"] = ywsjXhxt.substring(0, ywsjXhxt.length - 1);
		
		//谵妄
		if(data["shblZw"] != undefined){
			data["shblZw"] = '1';
		}else{
			data["shblZw"] = '0';
		}
		//喉部疼痛
		if(data["shblHbtt"] != undefined){
			data["shblHbtt"] = '1';
		}else{
			data["shblHbtt"] = '0';
		}
		//恶心
		if(data["shblEx"] != undefined){
			data["shblEx"] = '1';
		}else{
			data["shblEx"] = '0';
		}
		//眩晕
		if(data["shblXy"] != undefined){
			data["shblXy"] = '1';
		}else{
			data["shblXy"] = '0';
		}
		//呕吐
		if(data["shblOt"] != undefined){
			data["shblOt"] = '1';
		}else{
			data["shblOt"] = '0';
		}
		
		data["id"] = doc.documentId;
		
		if(flag){
			data["type"] = "t";
			data["ds"] = "4";
			data["ods"] = "3";
		}else{
			data["type"] = "t";
			data["ds"] = "3";
			data["ods"] = "3";
		}
		
// 		data["photo"] = "1,2,3";
// 		console.info(data);
		
		var dataJson = JSON.stringify(data);
// 		console.info(dataJson);
		
		$("#nav_btn").toggleClass("loading loading-light");
		
		$.ajax({
			type: "POST",
	 		url: "/updateDocInfo",
	  		data: "jsondata=" + dataJson,
			dataType: "json",
			success: function(data){
				if(data.code == 1){
					$("#nav_btn").toggleClass("loading loading-light");
					
					if(flag){
						location.href="/toDocList?ds=" + state;
					}
					else{
						layer.close(index);
						layer.open({
						    content: '草稿保存成功！'
						    ,btn: '我知道了'
						});
						location.reload();
					}
						
				}else{
					alert("网络失败,请重试!");
				}
	       	},
	     	error: function () {
	     		alert("网络异常,请重试!");
		 	}
		});
	}
	
	//手术史变更
	$(document).on('change', '#shs', function() {
		if($(this).val() == 1){
			$(".layui-m-layercont #shcs").removeAttr("disabled");
		}else{
			$(".layui-m-layercont #shcs").attr("disabled","disabled");
			$(".layui-m-layercont #shcs").val("");
		}
		
	});
	//呼吸系统选其他变更
	$(document).on('change', '#ywsjHxxt_6', function() {
		var state = 0;
		if($(this).is(":checked")){
			state = 1;
		}
		if(state == 1){
			$(".layui-m-layercont #ywsjHxxtQt").removeAttr("disabled");
		}else{
			$(".layui-m-layercont #ywsjHxxtQt").attr("disabled","disabled");
			$(".layui-m-layercont #ywsjHxxtQt").val("");
		}
	});
	//循环系统选其他变更
	$(document).on('change', '#ywsjXhxt_5', function() {
		var state = 0;
		if($(this).is(":checked")){
			state=1;
		};
		if(state == 1){
			$(".layui-m-layercont #ywsjXhxtQt").removeAttr("disabled");
		}else{
			$(".layui-m-layercont #ywsjXhxtQt").attr("disabled","disabled");
			$(".layui-m-layercont #ywsjXhxtQt").val("");
		}
	});
	//过敏原
	$(document).on('change', '#ywsjGm', function() {
		var ywsjGm = $('.layui-m-layercont #ywsjGm option:selected').val();
		if(ywsjGm == 2){
			$(".layui-m-layercont #ywsjGmSocre").removeAttr("disabled");
		}else{
			$(".layui-m-layercont #ywsjGmSocre").attr("disabled","disabled"); 
			$(".layui-m-layercont #ywsjGmSocre").val("");
		} 
		
	});
	
	//删除照片
    function deletePhoto(id){
		console.info(tmpBody);
    	var fileName = tmpBody.find("#photo_" + id).attr("name");
    	layer.open({
		    content: "确认删除图片？" ,
		   	btn: ['确认','取消'],
		    yes: function(index){
		    	console.info("开始删除");
		    	layer.close(index);
		    	photoCount = $("#photoCount").val();
		//     	console.info(fileName);
		    	$.ajax({
				    type: 'post',
				    url: '/deletePhotoByFileName',
				    data: 'id=' + doc.documentId + '&FileName='+ fileName,
				    success: function(data) {
				    	tmpBody.find("#photo_" + id).remove();
			        	
			        	var photo_tmp = "";
			        	var photo = tmpBody.find("#doc_photo").val();
			        	var photols = photo.split(",");
			        	var count = 0;
			        	for(var i = 0; i< photols.length; i++){
			        		console.info(photols.length + "         " + photols[i] + " : " + fileName)
			        		if(photols[i] != fileName){
			        			if(photo_tmp != ''){
			        				photo_tmp = photo_tmp + "," + photols[i];
			        				count++;
			        			}else
			    					photo_tmp = photols[i];
			        		}
			        	}
			        	$("#photoCount").val(count);
			        	console.info("photoCount:" + count);
			        	console.info("doc_photo:" + photo_tmp);
			        	tmpBody.find("#doc_photo").val(photo_tmp);
			        	doc.photo = photo_tmp;
						
						var dataJson = "{'type':'t', 'id':'" + doc.documentId + "', 'ds':'3', 'ods':'3', 'photo' : '" + photo_tmp + "'}";
						
						$.ajax({
							type: "POST",
					 		url: "/updateDocInfo",
					  		data: "jsondata=" + dataJson,
							dataType: "json",
							success: function(data2){
								if(data2.code == 1){
									
								}else{
									alert("网络失败,请重试!");
								}
					       	},
					     	error: function () {
					     		alert("网络异常,请重试!");
						 	}
						});
		           
						if(count < 2){
							tmpBody.find("#btnUpload").css("display", "");
						}
				    }
				});
		    }
		});
    }
	//------------------------------------------------    麻醉结束         ---------------------------------------------------------------//
	
	//------------------------------------------------    订单完成开始         ------------------------------------------------------------//
	function btnQrWcClick(){
		layer.open({
			content: "确认完成订单",
		   	btn: ['完成订单','取消'],
		    yes: function(index){
		    	$(this).toggleClass("loading loading-light");
				
				var dataJson = "{'type':'s', 'id':'" + doc.documentId + "', 'ds':'5', 'ods':'4'}";
		    	
				$.ajax({
					type: "POST",
			 		url: "/updateDocInfo",
			  		data: "jsondata=" + dataJson,
					dataType: "json",
					success: function(data){
						if(data.code == 1){
							$(this).toggleClass("loading loading-light");
							
							location.href="/toDocList?ds=" + state;
						}else{
							alert("网络失败,请重试!");
						}
			       	},
			     	error: function () {
			     		alert("网络异常,请重试!");
				 	}
				});
		    },
		    no: function(index){
		    	layer.close(index);
		    }
		});
	}
	
	function btnQxwcClick(){
		layer.open({
			type: 1,
			title: ['<span style=\"float: left;\">手术信息</span><button id=\"btnLayClose\" type=\"button\" class=\"btn btn-sm\" style=\"float: right;padding: 7 0;\"><i class=\"icon icon-times\"></i></button>', 'background-image:linear-gradient(-12deg,#8470FF 0,#6495ED 100%) !important; color:white;'],
		  	content: $("#pnlRetWait").html(),
		  	anim: 'scale',
		  	style: 'position:fixed; left:0; top:0;-webkit-overflow-scrolling: touch;overflow-y: scroll; width:100%; height:100%; border: none; -webkit-animation-duration: .5s; animation-duration: .5s;',
		  		success: function(elem){
					//全局参数
					var body = $("#" + elem.id);
					
					//按钮事件
					body.on('click', '#btnRetWaitClose', function() {
						layer.closeAll();
					});
					
					body.on('click', '#btnRetWaitSave', function() {
						layer.open({
							content: "确认退回",
						   	btn: ['确认','取消'],
						    yes: function(index){
						    	var adminMemo = body.find("#adminMemo").val();
						    	if(adminMemo == ""){
						    		alert("请填写退回修改原因！");
						    		layer.close(index);
						    	}else{
						    		var dataJson = "{'type':'twc', 'id':'" + doc.documentId + "', 'adminMemo': '" + adminMemo + "', 'ds':'3', 'ods':'4'}";
							    	
									$.ajax({
										type: "POST",
								 		url: "/updateDocInfo",
								  		data: "jsondata=" + dataJson,
										dataType: "json",
										success: function(data){
											if(data.code == 1){
												location.reload();
											}else{
												alert("网络失败,请重试!");
											}
								       	},
								     	error: function () {
								     		alert("网络异常,请重试!");
									 	}
									});
						    	}
						    },
						    no: function(index){
						    	layer.close(index);
						    }
						});
					});
					
					body.on('click', '#btnLayClose', function() {
						layer.closeAll();
					});
				}
		});
	}
	
	//------------------------------------------------    订单完成结束         ------------------------------------------------------------//
	
	//------------------------------------------------    评价打分开始         ------------------------------------------------------------//
	function btnDocDfClick(){
		layer.open({
			type: 1,
			title: ['<span style=\"float: left;\">评价打分</span><button id=\"btnLayClose\" type=\"button\" class=\"btn btn-sm\" style=\"float: right;padding: 7 0;\"><i class=\"icon icon-times\"></i></button>', 'background-image:linear-gradient(-12deg,#8470FF 0,#6495ED 100%) !important; color:white;'],
		  	content: $("#pnlDocDrDf").html(),
		  	anim: 'scale',
		  	style: 'position:fixed; left:0; top:0;-webkit-overflow-scrolling: touch;overflow-y: scroll; width:100%; height:100%; border: none; -webkit-animation-duration: .5s; animation-duration: .5s;',
	  		success: function(elem){
				//全局参数
				var body = $("#" + elem.id);
				
				layui.use(['rate'], function () {
			  		var rate = layui.rate;
					rate.render({
			      		elem: body.find('#dr_star')
			      		, text: true
			      		, value: doc.doctorEvaluate
			      		, setText: function(value){ //自定义文本的回调
			      			 var arrs = {
			      			        '1': '极差'
			      			        ,'2': '差'
			      			        ,'3': '一般'
			      			        ,'4': '好'
			      			        ,'5': '极好'
			      			  		,'0': '无评价'
			      			    	,'-1': '无评价'
			      			};
				      		if(value <= 0){
				      			this.span.text("无评价");
				      		}else if(value == 1){
				      			this.span.text("差");
				      		}else if(value == 2 || value == 3){
				      			this.span.text("一般");
				      		}else if(value == 4 || value == 5){
				      			this.span.text("满意");
				      		}
			      		}
				      	, choose: function (value) {
			            	body.find("#df_de").val(value);
			        	}
			      	})
				});
		      	body.find("#df_dem").val(doc.doctorEvaluateMemo);
				
				//按钮事件
				body.on('click', '#btnClose', function() {
					layer.closeAll();
				});
				
				body.on('click', '#btnDrDf', function() {
					var de = body.find("#df_de").val();
					var dem = body.find("#df_dem").val();
					
					layer.open({
						content: "保存评价",
					   	btn: ['保存','取消'],
					    yes: function(index){
					    	$.ajax({
				    			type: "POST",
				    	 		url: "/save_evaluation",
				    	 		data: {'id': doc.documentId, 'oid': doc.orgId , 'qid' : doc.qaUserId , 'evaluate':de, 'memo': dem , 'lid' : '', 'type':'1'},
				    			success: function(data){
				    				if(data.code == 1){
				    					alert("评分成功!");
				    					location.reload();
				    				}else{
										alert("评分失败,请重试!");
									}
						       	},
						     	error: function () {
						     		alert("网络失败,请关闭重试!");
							 	}
				    		});
					    },
					    no: function(index){
					    	layer.close(index);
					    }
					});
				});
				
				body.on('click', '#btnLayClose', function() {
					layer.closeAll();
				});
			}
		});
	}
	
	function changeStar(score){
		for(var i = 1; i <= 5; i++)
			$(".layui-m-layermain #df-dr-star-" + i).removeClass("active-star");
		for(var i = 1; i <= score; i++)
			$(".layui-m-layermain #df-dr-star-" + i).addClass("active-star");
		$(".layui-m-layermain #df_de").val(score);
	}
	
	//------------------------------------------------    评价打分结束        ------------------------------------------------------------//
	
	//------------------------------------------------    团队开始        --------------------------------------------------------------//
	var teambody;
	function createTeam(){
		layer.open({
			type: 1,
			title: ['<span style=\"float: left;\">创建团队</span><button id=\"btnLayClose\" type=\"button\" class=\"btn btn-sm\" style=\"float: right;padding: 7 0;\"><i class=\"icon icon-times\"></i></button>', 'background-image:linear-gradient(-12deg,#8470FF 0,#6495ED 100%) !important; color:white;'],
		  	content: $("#pnlTeamFp").html(),
		  	anim: 'scale',
		  	style: 'position:fixed; left:0; top:0;-webkit-overflow-scrolling: touch;overflow-y: scroll; width:100%; height:100%; border: none; -webkit-animation-duration: .5s; animation-duration: .5s;',
	  		success: function(elem){
				//全局参数
				var body = $("#" + elem.id);
				teambody = body;
				
				body.on('click', '#btnLayClose', function() {
					layer.closeAll();
				});
			}
		});
	}
	
	function btnFmUserAdd(){
		layer.open({
		  	type: 1,
		  	title: ['<span style=\"float: left;\">组员添加</span><button id=\"btnLayClose\" type=\"button\" class=\"btn btn-sm\" style=\"float: right;padding: 7 0;\"><i class=\"icon icon-times\"></i></button>', 'background-image:linear-gradient(-12deg,#8470FF 0,#6495ED 100%) !important; color:white;'],
		  	content: $("#pnlTeamUserList").html(),
		  	anim: 'scale',
		  	style: 'position:fixed; left:0; top:0;-webkit-overflow-scrolling: touch;overflow-y: scroll; width:100%; height:100%; border: none; -webkit-animation-duration: .5s; animation-duration: .5s;',
			success: function(elem, index){
				//全局参数
				var body = $("#" + elem.id);
				var obj = body.find("#team_table tbody");
				var elemid = elem.id;
				var index = elemid.replace("layui-m-layer","");
				
				//按钮事件
				body.on("click", "[name='btnSearch']", function() {
					var searchVal = body.find("#team_searchVal").val();
					searchTeamUser(obj, 5, searchVal);
				});
				
				body.on("click", "[name='btnSelected']", function() {
					var btn_id = this.id;
					var uinfo = btn_id.split("_");
					var uid = uinfo[1];
					
					setTeamSelected(teambody, index, 5, uid);
				});
				
				body.on('click', '#btnLayClose', function() {
					layer.closeAll();
				});
				
				//init
				searchTeamUser(obj, 5, "");
			}
		});
	}
	
	function btnHsUserAdd(){
		layer.open({
		  	type: 1,
		  	title: ['<span style=\"float: left;\">组员添加</span><button id=\"btnLayClose\" type=\"button\" class=\"btn btn-sm\" style=\"float: right;padding: 7 0;\"><i class=\"icon icon-times\"></i></button>', 'background-image:linear-gradient(-12deg,#8470FF 0,#6495ED 100%) !important; color:white;'],
		  	content: $("#pnlTeamUserList").html(),
		  	anim: 'scale',
		  	style: 'position:fixed; left:0; top:0;-webkit-overflow-scrolling: touch;overflow-y: scroll; width:100%; height:100%; border: none; -webkit-animation-duration: .5s; animation-duration: .5s;',
			success: function(elem, index){
				//全局参数
				var body = $("#" + elem.id);
				var obj = body.find("#team_table tbody");
				var elemid = elem.id;
				var index = elemid.replace("layui-m-layer","");
				
				//按钮事件
				body.on("click", "[name='btnSearch']", function() {
					var searchVal = body.find("#team_searchVal").val();
					searchTeamUser(obj, 6, searchVal);
				});
				
				body.on("click", "[name='btnSelected']", function() {
					var btn_id = this.id;
					var uinfo = btn_id.split("_");
					var uid = uinfo[1];
					
					setTeamSelected(teambody, index, 6, uid);
				});
				
				body.on('click', '#btnLayClose', function() {
					layer.closeAll();
				});
				
				//init
				searchTeamUser(obj, 6, "");
			}
		});
	}
	
	function searchTeamUser(obj, type, searchVal){
		$.ajax({
			type: "POST",
	 		url: "/getQaUserInfo",
	 		data: "id=" + doc.documentId + "&type=" + type + "&searchVal=" + searchVal,
			dataType: "json",
			success: function(data){
				var list = data.list;
				if(list != null){
					var result = "";
					
					for(var i = 0; i < list.length; i++){
						var u = list[i];
						result += "<tr>";
						result +="<td>" + u.userName + "</td>";
						result +="<td>" + u.age + "</td>";
						if(u.sex == '1')
				        	result +="<td>男</td>";
				  		else
				  			result +="<td>女</td>";
				        result +="<td><button name='btnSelected' id='btnSelected_" + u.userId + "' type='button' class='btn btn-sm'><i class='icon icon-cog'></i></button></td>";
				        result +="</tr>";
					}
					
					obj.html(result);
	             }else{
	            	obj.html("");
	             }
	       	},
	     	error: function () {
		   		alert("网络异常,请重试!");
		 	}
		});
	}
	
	function setTeamSelected(body, index, type, uid){
		$.ajax({
			type: "POST",
	 		url: "/addQaTeamUser",
	 		data: "id=" + doc.documentId + "&type=" + type + "&uid=" + uid,
			dataType: "json",
			success: function(data){
				if(data.code == '1'){
					layer.close(index);
					
					if(data.user != null){
						var html = appendUserInfo(body, data.user, type);
// 						console.info(type);
						if(type == '5'){
		            		body.find("#fm_main").append(html);
		            		body.find("#fm_main").css("display", "");
		            		body.find("#fm_add").css("display", "none");
						}else{
							body.find("#hs_main").append(html);
	               			body.find("#hs_main").css("display", "");
						}
						
						var icount = body.find("#TeamCount").val();
						if(icount > 0){
							$("#divTeam").html("<span style='font-size: .7rem;'><a style='cursor: pointer;color: blue;' onclick='openTeamView()'>团队信息</a></span>");
						}else{
							$("#divTeam").html("<span style='font-size: .7rem;'><a style='cursor: pointer;color: blue;padding-left: 10px;' onclick='createTeam()'>创建</a></span>");
						}
						
					}else{
						alert("新增出错");
					}
				}
	       	},
	     	error: function () {
		   		alert("网络异常,请重试!");
		 	}
		});
	}
	
	function openTeamView(){
		layer.open({
			type: 1,
			title: ['<span style=\"float: left;\">团队信息</span><button id=\"btnLayClose\" type=\"button\" class=\"btn btn-sm\" style=\"float: right;padding: 7 0;\"><i class=\"icon icon-times\"></i></button>', 'background-image:linear-gradient(-12deg,#8470FF 0,#6495ED 100%) !important; color:white;'],
		  	content: $("#pnlTeamFp").html(),
		  	anim: 'scale',
		  	style: 'position:fixed; left:0; top:0;-webkit-overflow-scrolling: touch;overflow-y: scroll; width:100%; height:100%; border: none; -webkit-animation-duration: .5s; animation-duration: .5s;',
	  		success: function(elem){
				//全局参数
				var body = $("#" + elem.id);
				teambody = body;
				
				$.ajax({
					type: "POST",
			 		url: "/showTeam",
			 		data: "id=" + doc.documentId,
					dataType: "json",
					success: function(data){
						var userls = data.list;
						
						if(userls != null){
			          		for(var i = 0; i < userls.length; i++){
			          			var user = userls[i];
// 			          			console.info(i + " " +user.roleId);
			          			if(user.roleId == '5'){
			                		//医生
			               			var html = appendUserInfo(body, user, '5');
			               			body.find("#fm_main").append(html);
			               			body.find("#fm_main").css("display", "");
			               			body.find("#fm_add").css("display", "none");
			                	}else{
			                		//护士
			               			var html = appendUserInfo(body, user, '6');
			               			body.find("#hs_main").append(html);
			               			body.find("#hs_main").css("display", "");
			               			
			               			if(doc.documentState != 3){
			               				body.find("#hs_add").css("display", "none");
			               			}
			                	}
			          		}
			          	}
						
						if(u.roleId < 5){
							body.find("#fm_add").css("display", "none");
							body.find("#hs_add").css("display", "none");
						}
			       	},
			     	error: function () {
				   		alert("网络异常,请重试!");
				 	}
				});
				
				body.on('click', '#btnLayClose', function() {
					layer.closeAll();
				});
				
			}
		});
	}
	
	function appendUserInfo(body, user, type){
		var icount = body.find("#TeamCount").val();
		icount++
		body.find("#TeamCount").val(icount);
    	var html = "<div class='list section rounded-lg'  style='margin: 10 auto;'>" +
    			   "<div class='row' id='UserInfo_" + user.userId + "' style='padding: 10px 10px 0 10px;'>" +
    			   "<table style='width:300px'>" + 
    			   "	<tr>" +
    			   "		<td>" +	
    			   "			<img style='width: 150px;height: 180px;' />" +	
    			   "		</td>" +	
    			   "		<td style='vertical-align: top;padding-left:10px;'>" +
    			   "			<table style='vertical-align: middle;border-collapse: separate;border-spacing: 10;'>" +
    			   "				<tr>" +
    			   "					<td>姓名：</td>" +
    			   "					<td>" + user.userName + "</td>" +
    			   "				</tr>" +
    			   "				<tr>" +
    			   "					<td>年龄：</td>" +
    			   "					<td>" + user.age + "</td>" +
    			   "				</tr>" +
    			   "				<tr>" +
    			   "					<td>性别：</td>" +
    			   "					<td>" + (user.sex == 1 ? '男':'女') + "</td>" +
    			   "				</tr>" +
    			   "			</table>" +
    			   "		</td>" +
    			   "	</tr>";
    			   if(doc.documentState == '3' && u.roleId > 4){
    				   html += "<tr>" + 
    				   		   "	<td colspan='2' >" +
    				   		   "		<button id='btnUserDel_" + user.userId + "' class='btn inverse outline addBox' style='width:100%;height:20px;padding:0 0 5px 0;' onclick='btnUserDel(\"" + user.userName + "\", " + user.userId + ", " + type + ")' >" +
   		 				   	   "			<i class='icon icon-minus' style='font-size: 20px;color: #aaa;' ></i>" +
   		 				   	   "		</button>" +
							   "	</td>" +
    				   		   "</tr>";
    			   }
	    html += "</table>" + 
	    		"</div>" +
	   		    "</div>";
		return html;
    }
	
	function btnUserDel(uname, uid, type){
		layer.open({
		    content: "确认删除团队成员：" + uname,
		   	btn: ['确认','取消'],
		    yes: function(index){
		    	$.ajax({
					type: "POST",
			 		url: "/delQaTeamUser",
			 		data: "id=" + doc.documentId + "&uid=" + uid,
					dataType: "json",
					success: function(data){
						if(type == '5'){
							teambody.find("#UserInfo_" + uid).remove();
							teambody.find("#fm_main").css("display", "none");
							teambody.find("#fm_add").css("display", "");
		            	}else{
		            		teambody.find("#UserInfo_" + uid).remove();
		            	}
						
						var icount = teambody.find("#TeamCount").val();
						icount--;
						teambody.find("#TeamCount").val(icount);
						if(icount > 0){
							$("#divTeam").html("<span style='font-size: .7rem;'><a style='cursor: pointer;color: blue;' onclick='openTeamView()'>团队信息</a></span>");
						}else{
							$("#divTeam").html("<span style='font-size: .7rem;'><a style='cursor: pointer;color: blue;padding-left: 10px;' onclick='createTeam()'>创建</a></span>");
						}
						
						layer.close(index);
			       	},
			     	error: function () {
				   		alert("网络异常,请重试!");
				 	}
				});
		    }
		});
		
	}
	
	//------------------------------------------------    团队结束        --------------------------------------------------------------//
	
	//------------------------------------------------    取消订单开始        -----------------------------------------------------------//
	function btnQxClick(){
		layer.open({
			type: 1,
			title: ['<span style=\"float: left;\">取消订单</span><button id=\"btnLayClose\" type=\"button\" class=\"btn btn-sm\" style=\"float: right;padding: 7 0;\"><i class=\"icon icon-times\"></i></button>', 'background-image:linear-gradient(-12deg,#8470FF 0,#6495ED 100%) !important; color:white;'],
		  	content: $("#pnlCannel").html(),
		  	anim: 'scale',
		  	style: 'position:fixed; left:0; top:0;-webkit-overflow-scrolling: touch;overflow-y: scroll; width:100%; height:100%; border: none; -webkit-animation-duration: .5s; animation-duration: .5s;',
	  		success: function(elem){
				//全局参数
				var body = $("#" + elem.id);
				teambody = body;
				
// 				$.ajax({
// 					type: "POST",
// 			 		url: "/showTeam",
// 			 		data: "id=" + doc.documentId,
// 					dataType: "json",
// 					success: function(data){
// 						var userls = data.list;
						
// 						if(userls != null){
// 			          		for(var i = 0; i < userls.length; i++){
// 			          			var user = userls[i];
// 			          			console.info(i + " " +user.roleId);
// 			          			if(user.roleId == '5'){
// 			                		//医生
// 			               			var html = appendUserInfo(body, user, '5');
// 			               			body.find("#fm_main").append(html);
// 			               			body.find("#fm_main").css("display", "");
// 			               			body.find("#fm_add").css("display", "none");
// 			                	}else{
// 			                		//护士
// 			               			var html = appendUserInfo(body, user, '6');
// 			               			body.find("#hs_main").append(html);
// 			               			body.find("#hs_main").css("display", "");
			               			
// 			               			if(doc.documentState != 3){
// 			               				body.find("#hs_add").css("display", "none");
// 			               			}
// 			                	}
// 			          		}
// 			          	}
// 			       	},
// 			     	error: function () {
// 				   		alert("网络异常,请重试!");
// 				 	}
// 				});
				body.on('click', '#btnQxSave', function() {
					var reason = body.find("#reason").val();
					var qxRadio = body.find("input[name='qxRadio']:checked").val();
// 					if(reason == null || typeof(reason)=="undefined" || reason == ''){
// 						layer.open({
// 							content: '取消订单，取消原因不能为空！'
// 						    ,btn: '关闭'
// 						});
// 						return false;
// 					}
// 					alert(qxRadio);
					if(qxRadio == null || typeof(qxRadio)=="undefined" || qxRadio == ''){
						layer.open({
							content: '取消订单，取消原因不能为空！'
						    ,btn: '关闭'
						});
						return false;
					}
					
					layer.open({
					    content: "确认取消订单？",
					   	btn: ['确认','取消'],
					    yes: function(index){
							$(this).toggleClass("loading loading-light");
							
							var dataJson = "{'type':'s', 'id':'" + doc.documentId + "', 'ds':'9', 'ods':'" + doc.documentState + "','reason':'" + reason + "','qxRadio':'" + qxRadio + "'}";
					    	
							$.ajax({
								type: "POST",
						 		url: "/updateDocInfo",
						  		data: "jsondata=" + dataJson,
								dataType: "json",
								success: function(data){
									if(data.code == 1){
										$(this).toggleClass("loading loading-light");
										
										location.href="/toDocList?ds=" + state;
									}else{
										alert("网络失败,请重试!");
									}
						       	},
						     	error: function () {
						     		alert("网络异常,请重试!");
							 	}
							});
					    }
					});
				});
				
				body.on('click', '#btnLayClose', function() {
					layer.closeAll();
				});
			}
		});
	}
	
	function btnQxJjClick(){
		layer.open({
		    content: "拒绝取消订单？",
		   	btn: ['确认','取消'],
		    yes: function(index){
				$(this).toggleClass("loading loading-light");
				
				var dataJson = "{'type':'s', 'id':'" + doc.documentId + "', 'ds':'" + doc.oldDocumentState + "', 'ods':'9'}";
		    	
				$.ajax({
					type: "POST",
			 		url: "/updateDocInfo",
			  		data: "jsondata=" + dataJson,
					dataType: "json",
					success: function(data){
						if(data.code == 1){
							$(this).toggleClass("loading loading-light");
							
							location.href="/toDocList?ds=" + state;
						}else{
							alert("网络失败,请重试!");
						}
			       	},
			     	error: function () {
			     		alert("网络异常,请重试!");
				 	}
				});
		    }
		});
	}
	
	function btnQxTyClick(){
		layer.open({
		    content: "同意取消订单？",
		   	btn: ['确认','取消'],
		    yes: function(index){
				$(this).toggleClass("loading loading-light");
				
				var dataJson = "{'type':'s', 'id':'" + doc.documentId + "', 'ds':'6', 'ods':'9'}";
		    	
				$.ajax({
					type: "POST",
			 		url: "/updateDocInfo",
			  		data: "jsondata=" + dataJson,
					dataType: "json",
					success: function(data){
						if(data.code == 1){
							$(this).toggleClass("loading loading-light");
							
							location.href="/toDocList?ds=" + state;
						}else{
							alert("网络失败,请重试!");
						}
			       	},
			     	error: function () {
			     		alert("网络异常,请重试!");
				 	}
				});
		    }
		});
	}
	//------------------------------------------------    取消订单结束        -----------------------------------------------------------//
	
	function previewImg(obj) {
       	const viewer = new Viewer(obj, {
       		viewed() {
       		    viewer.zoomTo(1);
       		},
       	});  
 	}
</script>
</body>
</html>